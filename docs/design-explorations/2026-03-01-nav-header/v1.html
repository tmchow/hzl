<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Exploration</title>

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js" defer></script>
  <!-- Google Fonts: Shell (DM Sans, JetBrains Mono) + Variation families -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- Exploration metadata (agent-readable) -->
  <script type="application/json" id="exploration-metadata">
  {
  "project": "HZL Dashboard",
  "topic": "nav-header",
  "round": 1,
  "date": "2026-03-01",
  "previousRound": null,
  "sourceDirectory": "docs/design-explorations/2026-03-01-nav-header",
  "families": [
    {
      "letter": "A",
      "name": "Stacked Layers",
      "approach": "What if each conceptual layer (view nav, contextual filters, global actions) had its own horizontal row? Clear separation of concerns, filters row adapts or hides per view."
    },
    {
      "letter": "B",
      "name": "Compact Rail",
      "approach": "What if view navigation lived in a narrow vertical sidebar, freeing the entire top bar for contextual filters and actions? Spatial separation — vertical for navigation, horizontal for context."
    },
    {
      "letter": "C",
      "name": "Unified Bar",
      "approach": "What if everything stayed in a single compact row with strict visual hierarchy? View switcher as prominent control, filters behind progressive disclosure, minimal footprint."
    }
  ],
  "variations": [
    {
      "id": "A1",
      "family": "A",
      "familyName": "Stacked Layers",
      "name": "Toolbar Stack",
      "layoutType": "Two-row horizontal",
      "aesthetic": "HZL Dark (shared)",
      "description": "Two distinct rows: top row has logo, filled tab buttons for views, connection status, and activity toggle. Bottom row has all contextual filters as dropdowns. Bottom row hides on views that don't need filters."
    },
    {
      "id": "A2",
      "family": "A",
      "familyName": "Stacked Layers",
      "name": "Underline Tabs",
      "layoutType": "Two-row with underline nav",
      "aesthetic": "HZL Dark (shared)",
      "description": "Two rows but lighter touch: top row uses underline-style text tabs for views. Bottom row uses compact pill-shaped filter chips instead of full-width dropdowns. More breathing room, editorial feel."
    },
    {
      "id": "B1",
      "family": "B",
      "familyName": "Compact Rail",
      "name": "Icon Rail",
      "layoutType": "Vertical icon sidebar + top bar",
      "aesthetic": "HZL Dark (shared)",
      "description": "Narrow 48px left rail with HZL logo and 4 view icons stacked vertically. Active view indicated by accent bar. Full-width top bar holds all filters, search, connection, and activity. Rail collapses to bottom tab bar on mobile."
    },
    {
      "id": "B2",
      "family": "B",
      "familyName": "Compact Rail",
      "name": "Label Rail",
      "layoutType": "Vertical labeled sidebar + top bar",
      "aesthetic": "HZL Dark (shared)",
      "description": "Wider 120px left rail with logo and text-labeled view links. Active view has filled background. Top bar is purely contextual filters. More discoverable than icon-only — labels make views scannable. Rail becomes bottom nav on mobile."
    },
    {
      "id": "C1",
      "family": "C",
      "familyName": "Unified Bar",
      "name": "Segmented Control",
      "layoutType": "Single row with segmented switcher",
      "aesthetic": "HZL Dark (shared)",
      "description": "Everything in one row: logo, prominent segmented control for views, a single 'Filters' button that opens a dropdown panel, search input, connection status, activity. Ultra-clean, minimal horizontal real estate. Filters panel shows contextual controls per view."
    },
    {
      "id": "C2",
      "family": "C",
      "familyName": "Unified Bar",
      "name": "Pill Switcher",
      "layoutType": "Single row with pill buttons",
      "aesthetic": "HZL Dark (shared)",
      "description": "Single row: logo, individual pill buttons for each view (active one is filled), thin vertical separator, then compact inline filter chips that expand on click. Everything visible at once but with clear visual weight hierarchy. On mobile, pills scroll horizontally, filter chips collapse to an icon."
    }
  ]
}

  </script>

  <style>
    /* === Shell Design Tokens (FIXED — identical in every file) === */
    :root {
      --shell-bg: #0c0c0d;
      --shell-bg-raised: #17191a;
      --shell-bg-hover: #232527;
      --shell-bg-active: #2f3233;
      --shell-border: rgba(255,255,255,0.06);
      --shell-border-hover: rgba(255,255,255,0.1);
      --shell-text: #708a9e;
      --shell-text-bright: #dbe2e7;
      --shell-text-dim: #445664;
      --shell-accent: #62929e;
      --shell-accent-hover: #81a8b1;
      --shell-accent-glow: rgba(98,146,158,0.15);
      --shell-star-filled: #d4a853;
      --shell-star-empty: #445664;
      --shell-radius: 8px;
      --shell-radius-sm: 5px;
      --shell-font-mono: 'JetBrains Mono', monospace;
      --shell-font-ui: 'DM Sans', sans-serif;
      --shell-sidebar-width: 240px;
      --shell-topbar-height: 48px;
    }

    [x-cloak] { display: none !important; }

    /* === Shell Atmosphere === */
    body {
      background: var(--shell-bg);
      background-image:
        radial-gradient(ellipse at 20% 0%, rgba(98,146,158,0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(84,106,123,0.03) 0%, transparent 50%);
      color: #708a9e;
      margin: 0;
      padding: 0;
    }

  </style>
</head>
<body x-data="explorer()" @keydown.window="handleKey($event)"
      class="h-screen overflow-hidden flex" style="font-family: var(--shell-font-ui)">

  <!-- ==================== SIDEBAR ==================== -->
  <aside class="flex flex-col h-full flex-shrink-0"
         style="width: var(--shell-sidebar-width); background: var(--shell-bg-raised); border-right: 1px solid var(--shell-border)">

    <!-- Header (matches topbar height so borders align) -->
    <div class="px-4 flex items-center gap-3 flex-shrink-0"
         style="height: var(--shell-topbar-height); border-bottom: 1px solid var(--shell-border)">
      <span style="color: var(--shell-accent); font-size: 16px; line-height: 1">&#9670;</span>
      <div class="flex flex-col justify-center min-w-0" style="gap: 3px">
        <span style="color: var(--shell-text-bright); font-size: 13px; font-weight: 600; line-height: 1">Design Exploration</span>
        <span style="color: #c6c5b9; font-size: 11px; line-height: 1" class="truncate"
              x-text="meta.project || ''"></span>
      </div>
    </div>

    <!-- Variation List -->
    <div class="flex-1 overflow-y-auto py-3 px-2">
      <template x-for="fam in families" :key="fam.letter">
        <div class="mb-4">
          <!-- Family header — small label, uses silver for legibility -->
          <div class="flex items-center gap-1.5 px-3 mb-1.5 mt-1">
            <span style="font-family: var(--shell-font-mono); font-size: 10px; color: #c6c5b9; font-weight: 500; opacity: 0.6"
                  x-text="fam.letter"></span>
            <span style="font-size: 10px; color: #c6c5b9; text-transform: uppercase; letter-spacing: 0.06em; font-weight: 500; opacity: 0.6"
                  x-text="fam.name"></span>
          </div>
          <!-- Variation items — prominent, indented under family -->
          <template x-for="v in fam.variations" :key="v.id">
            <button @click="selectVariation(v.id)"
                    class="w-full text-left rounded group"
                    style="display: grid; grid-template-columns: auto 1fr; column-gap: 10px; padding: 8px 10px 8px 16px; transition: all 150ms ease; border: none; cursor: pointer"
                    :style="current.id === v.id
                      ? 'background: #2f3233; border-left: 3px solid #62929e; box-shadow: inset 3px 0 12px rgba(98,146,158,0.15); margin-left: 0; padding-left: 13px'
                      : 'border-left: 3px solid transparent; margin-left: 0; padding-left: 13px'"
                    :class="current.id === v.id ? '' : 'hover:bg-[#232527]'">
              <span style="grid-row: 1 / 3; align-self: baseline; font-family: var(--shell-font-mono); font-size: 11px; line-height: 1.4"
                    :style="current.id === v.id ? 'color: #62929e' : 'color: #445664'"
                    x-text="v.id"></span>
              <div class="truncate" style="font-size: 13px; font-weight: 500; line-height: 1.4"
                   :style="current.id === v.id ? 'color: #dbe2e7' : 'color: #708a9e'"
                   x-text="v.name"></div>
              <div class="flex items-center gap-0.5" style="grid-column: 2; min-height: 16px">
                <template x-if="ratings[v.id]?.stars === 0">
                  <span style="color: #ef4444; font-size: 10px">&#10007;</span>
                </template>
                <template x-if="ratings[v.id]?.stars > 0">
                  <span class="flex gap-0.5">
                    <template x-for="s in (ratings[v.id]?.stars || 0)" :key="s">
                      <span style="color: #d4a853; font-size: 9px">&#9733;</span>
                    </template>
                  </span>
                </template>
              </div>
            </button>
          </template>
        </div>
      </template>
    </div>

    <!-- Footer -->
    <div class="px-3 py-3" style="border-top: 1px solid var(--shell-border)">
      <div class="flex items-center gap-1 mb-2 justify-center">
        <template x-for="v in variations" :key="v.id">
          <span class="rounded-full" style="width: 8px; height: 8px"
                :style="ratings[v.id]?.stars == null ? 'background: #33404b'
                  : ratings[v.id].stars === 0 ? 'background: #ef4444'
                  : ratings[v.id].stars >= 4 ? 'background: #d4a853'
                  : ratings[v.id].stars >= 2 ? 'background: #facc15'
                  : 'background: #ef4444'"></span>
        </template>
      </div>
      <div class="text-center mb-2" style="font-size: 12px; color: #445664"
           x-text="reviewedCount + '/' + variations.length + ' reviewed'"></div>
      <button @click="showExport = true"
              class="w-full py-2.5 rounded text-center"
              style="background: #62929e; color: white; font-size: 13px; font-weight: 600; border: none; border-radius: 5px; cursor: pointer; transition: background 150ms"
              @mouseover="$el.style.background='#81a8b1'"
              @mouseout="$el.style.background='#62929e'">Next Round<span x-text="' (' + reviewedCount + '/' + variations.length + ')'"></span></button>
    </div>
  </aside>

  <!-- ==================== MAIN AREA ==================== -->
  <div class="flex-1 flex flex-col min-w-0">

    <!-- TOP BAR -->
    <div class="flex items-center px-4 flex-shrink-0"
         style="height: var(--shell-topbar-height); background: var(--shell-bg-raised); border-bottom: 1px solid var(--shell-border)">
      <!-- Nav arrows -->
      <div class="flex items-center gap-1">
        <button @click="prev()" class="w-8 h-8 flex items-center justify-center rounded"
                style="color: #708a9e; font-family: var(--shell-font-mono); font-size: 16px; background: transparent; border: none; cursor: pointer; transition: all 150ms"
                @mouseover="$el.style.background='#232527';$el.style.color='#dbe2e7'"
                @mouseout="$el.style.background='transparent';$el.style.color='#708a9e'">&larr;</button>
        <button @click="next()" class="w-8 h-8 flex items-center justify-center rounded"
                style="color: #708a9e; font-family: var(--shell-font-mono); font-size: 16px; background: transparent; border: none; cursor: pointer; transition: all 150ms"
                @mouseover="$el.style.background='#232527';$el.style.color='#dbe2e7'"
                @mouseout="$el.style.background='transparent';$el.style.color='#708a9e'">&rarr;</button>
      </div>
      <!-- Current variation info -->
      <div class="flex-1 flex items-center justify-center gap-3">
        <span style="font-family: var(--shell-font-mono); color: var(--shell-accent); font-size: 14px; font-weight: 500"
              x-text="current.id"></span>
        <span style="color: var(--shell-text-bright); font-size: 14px; font-weight: 500"
              x-text="current.name"></span>
        <span class="hidden sm:inline-flex items-center gap-2">
          <span class="rounded-full px-2.5 py-0.5"
                style="background: var(--shell-bg-hover); color: #c6c5b9; font-size: 11px; font-family: var(--shell-font-mono); opacity: 0.7"
                x-text="current.layoutType"></span>
          <span style="color: #c6c5b9; font-size: 11px; opacity: 0.4">&middot;</span>
          <span class="rounded-full px-2.5 py-0.5"
                style="background: var(--shell-bg-hover); color: #c6c5b9; font-size: 11px; font-family: var(--shell-font-mono); opacity: 0.7"
                x-text="current.aesthetic"></span>
        </span>
      </div>
      <!-- Toggles -->
      <div class="flex items-center gap-1">
        <button @click="showShortcuts = !showShortcuts"
                class="w-8 h-8 flex items-center justify-center rounded"
                :style="showShortcuts ? 'background: rgba(98,146,158,0.15); color: #62929e' : 'color: #708a9e'"
                style="font-family: var(--shell-font-mono); font-size: 13px; color: #708a9e; background: transparent; border: none; cursor: pointer; transition: all 150ms; font-weight: 500"
                @mouseover="if(!showShortcuts){$el.style.background='#232527';$el.style.color='#dbe2e7'}"
                @mouseout="if(!showShortcuts){$el.style.background='transparent';$el.style.color='#708a9e'}">?</button>
      </div>
    </div>

    <!-- PREVIEW + TUNE PANEL (side by side) -->
    <div class="flex-1 flex min-h-0">
      <!-- PREVIEW STAGE -->
      <div id="preview-stage"
           class="flex-1 overflow-hidden relative"
           :class="[isTransitioning ? 'opacity-0' : 'opacity-100']"
           style="transition: opacity 150ms ease">
        <iframe x-ref="iframe" @load="onIframeLoad()"
                style="width: 100%; height: 100%; border: none"></iframe>
      </div>

      <!-- TUNE PANEL (right side) -->
      <div x-show="showControls && current.controls.length" x-cloak
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 w-0"
           x-transition:enter-end="opacity-100"
           x-transition:leave="transition ease-in duration-150"
           x-transition:leave-start="opacity-100"
           x-transition:leave-end="opacity-0 w-0"
           class="flex-shrink-0 flex flex-col overflow-hidden"
           style="width: 260px; background: var(--shell-bg-raised); border-left: 1px solid var(--shell-border)">
        <!-- Header -->
        <div class="flex items-center justify-between px-3 flex-shrink-0"
             style="height: var(--shell-topbar-height); border-bottom: 1px solid var(--shell-border)">
          <span style="font-family: var(--shell-font-mono); font-size: 12px; color: var(--shell-text)">Tune</span>
          <button @click="showControls = false"
                  style="color: var(--shell-text-dim); font-size: 16px; transition: color 150ms; background: none; border: none; cursor: pointer"
                  @mouseover="$el.style.color='var(--shell-text-bright)'"
                  @mouseout="$el.style.color='var(--shell-text-dim)'">&times;</button>
        </div>
        <!-- Controls body -->
        <div class="flex-1 p-3 overflow-y-auto">
          <template x-for="control in current.controls" :key="control.id">
            <div class="mb-4">
              <div class="flex justify-between items-center mb-1.5">
                <label style="font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--shell-text); font-family: var(--shell-font-mono)"
                       x-text="control.label"></label>
                <span x-show="control.type === 'range' && control.value != null"
                      style="font-size: 11px; color: var(--shell-text); font-family: var(--shell-font-mono); font-variant-numeric: tabular-nums"
                      x-text="control.value + (control._displayUnit || control.unit || '')"></span>
              </div>
              <!-- Range -->
              <template x-if="control.type === 'range'">
                <input type="range" :min="control.min" :max="control.max" :step="control.step"
                       :value="control.value"
                       @input="updateControl(control.id, +$event.target.value)"
                       class="w-full h-1.5 rounded-full appearance-none cursor-pointer"
                       style="background: var(--shell-bg); accent-color: var(--shell-accent)">
              </template>
              <!-- Select (segmented) -->
              <template x-if="control.type === 'select'">
                <div class="flex rounded-md overflow-hidden" style="border: 1px solid var(--shell-border)">
                  <template x-for="opt in control.options" :key="opt">
                    <button @click="updateControl(control.id, opt)"
                            class="flex-1 px-2 py-1.5 transition-all duration-150"
                            :style="(control.value === opt
                              ? 'background: var(--shell-accent); color: white'
                              : 'color: var(--shell-text)')
                              + '; font-family: var(--shell-font-mono); font-size: 12px'"
                            x-text="opt"></button>
                  </template>
                </div>
              </template>
              <!-- Toggle -->
              <template x-if="control.type === 'toggle'">
                <div>
                  <button @click="updateControl(control.id, !control.value)"
                          class="rounded-full relative transition-colors duration-200"
                          style="width: 36px; height: 20px; border: none; cursor: pointer; padding: 0; flex-shrink: 0"
                          :style="control.value ? 'background: var(--shell-accent)' : 'background: var(--shell-bg-active)'">
                    <span class="absolute rounded-full transition-all duration-200"
                          style="top: 2px; left: 2px; width: 16px; height: 16px; background: var(--shell-text-bright)"
                          :style="control.value ? 'transform: translateX(16px)' : 'transform: translateX(0)'"></span>
                  </button>
                </div>
              </template>
            </div>
          </template>
        </div>
        <!-- Footer -->
        <div class="px-3 py-2 flex items-center justify-between flex-shrink-0" style="border-top: 1px solid var(--shell-border)">
          <button @click="replayVariation()"
                  class="flex items-center gap-1"
                  style="font-size: 11px; color: var(--shell-text-dim); transition: color 150ms; background: none; border: none; cursor: pointer"
                  @mouseover="$el.style.color='var(--shell-text-bright)'"
                  @mouseout="$el.style.color='var(--shell-text-dim)'">
            <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 4v5h5"/><path d="M3.51 10a6 6 0 1 0 .49-5.5L1 9"/>
            </svg>
            Reload
          </button>
          <button @click="resetControls()"
                  style="font-size: 11px; color: var(--shell-text-dim); transition: color 150ms; background: none; border: none; cursor: pointer"
                  @mouseover="$el.style.color='var(--shell-text-bright)'"
                  @mouseout="$el.style.color='var(--shell-text-dim)'">Reset to defaults</button>
        </div>
      </div>
    </div>

    <!-- RATING BAR -->
    <div class="flex items-center gap-5 px-6 flex-shrink-0"
         style="height: 64px; background: #17191a; border-top: 1px solid rgba(255,255,255,0.06)">
      <!-- Skip -->
      <button @click="rate(0)" class="flex items-center justify-center"
              title="Skip — exclude from next round (0)"
              style="width: 32px; height: 32px; font-size: 18px; color: #445664; cursor: pointer; background: none; border: none; padding: 0; transition: all 200ms ease"
              :style="currentRating.stars === 0 ? 'color: #ef4444' : 'color: #445664'"
              @mouseover="$el.style.transform = 'scale(1.15)'"
              @mouseout="$el.style.transform = 'scale(1)'">&#10007;</button>
      <!-- Stars -->
      <div class="flex items-center gap-0.5">
        <template x-for="s in 5" :key="s">
          <button @click="rate(s)" class="flex items-center justify-center"
                  :title="s + ' star' + (s > 1 ? 's' : '') + ' (' + s + ')'"
                  style="width: 32px; height: 32px; font-size: 22px; color: #445664; transition: transform 200ms ease; cursor: pointer; background: none; border: none; padding: 0; line-height: 1"
                  :style="s <= (currentRating.stars || 0) ? 'color: #d4a853' : 'color: #445664'"
                  @mouseover="$el.style.transform = 'scale(1.15)'"
                  @mouseout="$el.style.transform = 'scale(1)'">&#9733;</button>
        </template>
      </div>
      <!-- Divider -->
      <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.08)"></div>
      <!-- Tune -->
      <button x-show="current.controls.length" @click="showControls = !showControls"
              class="flex items-center gap-1.5 rounded flex-shrink-0"
              style="padding: 6px 10px; font-family: var(--shell-font-mono); font-size: 12px; border: 1px solid var(--shell-border); cursor: pointer; transition: all 150ms"
              :style="showControls
                ? 'background: rgba(98,146,158,0.15); color: var(--shell-accent); border-color: rgba(98,146,158,0.3)'
                : 'background: transparent; color: var(--shell-text)'"
              @mouseover="if(!showControls){$el.style.background='var(--shell-bg-hover)';$el.style.color='var(--shell-text-bright)'}"
              @mouseout="if(!showControls){$el.style.background='transparent';$el.style.color='var(--shell-text)'}">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
          <line x1="2" y1="4" x2="14" y2="4"/><circle cx="5" cy="4" r="1.5" fill="currentColor" stroke="none"/>
          <line x1="2" y1="8" x2="14" y2="8"/><circle cx="11" cy="8" r="1.5" fill="currentColor" stroke="none"/>
          <line x1="2" y1="12" x2="14" y2="12"/><circle cx="7" cy="12" r="1.5" fill="currentColor" stroke="none"/>
        </svg>
        Tune
      </button>
      <!-- Notes -->
      <input type="text" class="flex-1"
             :value="currentRating.notes"
             @input="updateNotes($event.target.value)"
             placeholder="Add a note about this variation..."
             style="background: #0c0c0d; border: 1px solid rgba(255,255,255,0.1); color: #dbe2e7; font-family: var(--shell-font-ui); font-size: 13px; padding: 8px 14px; border-radius: 5px; outline: none; transition: border-color 150ms"
             onfocus="this.style.borderColor='rgba(255,255,255,0.18)'"
             onblur="this.style.borderColor='rgba(255,255,255,0.1)'">
      <!-- Ship It -->
      <button @click="openFinalize()"
              class="flex items-center gap-1.5 flex-shrink-0 rounded"
              style="padding: 8px 14px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; transition: all 150ms; background: transparent; color: var(--shell-accent); border: 1px solid rgba(98,146,158,0.3)"
              @mouseover="$el.style.background='rgba(98,146,158,0.15)'"
              @mouseout="$el.style.background='transparent'">Ship It ⛵</button>
    </div>
  </div>

  <!-- ==================== EXPORT MODAL ==================== -->
  <div x-show="showExport" class="fixed inset-0 z-50 flex items-center justify-center"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
    <div class="absolute inset-0" style="background: rgba(0,0,0,0.6); backdrop-filter: blur(8px)" @click="showExport = false"></div>
    <div class="relative flex flex-col"
         style="width: 640px; max-height: 80vh; background: var(--shell-bg-raised); border: 1px solid var(--shell-border); border-radius: var(--shell-radius); box-shadow: 0 4px 24px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.3)"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100">
      <!-- Header -->
      <div class="flex items-center justify-between px-5 py-3" style="border-bottom: 1px solid var(--shell-border)">
        <span style="color: var(--shell-text-bright); font-size: 15px; font-weight: 600">Export Feedback</span>
        <button @click="showExport = false"
                style="color: var(--shell-text-dim); font-size: 20px; background: none; border: none; cursor: pointer; transition: color 150ms"
                @mouseover="$el.style.color='var(--shell-text-bright)'"
                @mouseout="$el.style.color='var(--shell-text-dim)'">&times;</button>
      </div>
      <!-- Body -->
      <div class="flex-1 overflow-y-auto p-5">
        <pre class="p-4 rounded overflow-x-auto whitespace-pre-wrap mb-4"
             style="background: var(--shell-bg); border: 1px solid var(--shell-border); border-radius: var(--shell-radius-sm); font-family: var(--shell-font-mono); font-size: 13px; color: var(--shell-text-bright); user-select: all"
             x-text="generateFeedback()"></pre>
        <label style="display: block; font-size: 12px; color: var(--shell-text-dim); margin-bottom: 6px; font-weight: 500">Direction for Next Round</label>
        <textarea x-model="directionText"
                  rows="5"
                  placeholder="What should the next round focus on? Which directions to keep, drop, or explore further..."
                  style="width: 100%; background: var(--shell-bg); border: 1px solid var(--shell-border); color: var(--shell-text-bright); font-family: var(--shell-font-ui); font-size: 13px; padding: 12px; border-radius: var(--shell-radius-sm); outline: none; resize: vertical; transition: border-color 150ms"
                  onfocus="this.style.borderColor='rgba(255,255,255,0.1)'"
                  onblur="this.style.borderColor='rgba(255,255,255,0.06)'"></textarea>
      </div>
      <!-- Footer -->
      <div class="px-5 py-3 flex-shrink-0" style="border-top: 1px solid var(--shell-border)">
        <button @click="copyFeedback()"
                class="w-full py-2.5 rounded text-white text-center"
                style="background: var(--shell-accent); font-size: 13px; font-weight: 600; border-radius: var(--shell-radius-sm); transition: background 150ms"
                @mouseover="$el.style.background='var(--shell-accent-hover)'"
                @mouseout="$el.style.background='var(--shell-accent)'"
                x-text="copiedFeedback ? '&#10003; Copied!' : 'Copy to Clipboard'"></button>
      </div>
    </div>
  </div>

  <!-- ==================== FINALIZE MODAL ==================== -->
  <div x-show="showFinalize" class="fixed inset-0 z-50 flex items-center justify-center"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
    <div class="absolute inset-0" style="background: rgba(0,0,0,0.6); backdrop-filter: blur(8px)" @click="showFinalize = false"></div>
    <div class="relative flex flex-col"
         style="width: 640px; max-height: 80vh; background: var(--shell-bg-raised); border: 1px solid var(--shell-border); border-radius: var(--shell-radius); box-shadow: 0 4px 24px rgba(0,0,0,0.4), 0 1px 4px rgba(0,0,0,0.3)"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100">
      <!-- Header -->
      <div class="flex items-center justify-between px-5 py-3" style="border-bottom: 1px solid var(--shell-border)">
        <div class="flex items-center gap-3">
          <span style="color: var(--shell-text-bright); font-size: 15px; font-weight: 600">Go With This</span>
          <span style="color: var(--shell-accent); font-family: var(--shell-font-mono); font-size: 13px" x-text="current.id"></span>
          <span style="color: var(--shell-text); font-size: 13px" x-text="current.name"></span>
        </div>
        <button @click="showFinalize = false"
                style="color: var(--shell-text-dim); font-size: 20px; background: none; border: none; cursor: pointer; transition: color 150ms"
                @mouseover="$el.style.color='var(--shell-text-bright)'"
                @mouseout="$el.style.color='var(--shell-text-dim)'">&times;</button>
      </div>
      <!-- Body -->
      <div class="flex-1 overflow-y-auto p-5">
        <pre class="p-4 rounded overflow-x-auto whitespace-pre-wrap mb-4"
             style="background: var(--shell-bg); border: 1px solid var(--shell-border); border-radius: var(--shell-radius-sm); font-family: var(--shell-font-mono); font-size: 13px; color: var(--shell-text-bright); user-select: all"
             x-text="generateDirection()"></pre>
        <label style="display: block; font-size: 12px; color: var(--shell-text-dim); margin-bottom: 6px; font-weight: 500">Notes</label>
        <textarea x-model="finalizeNotes"
                  rows="5"
                  placeholder="What matters most about this direction? Any elements to borrow from other variations? Constraints for implementation..."
                  style="width: 100%; background: var(--shell-bg); border: 1px solid var(--shell-border); color: var(--shell-text-bright); font-family: var(--shell-font-ui); font-size: 13px; padding: 12px; border-radius: var(--shell-radius-sm); outline: none; resize: vertical; transition: border-color 150ms"
                  onfocus="this.style.borderColor='rgba(255,255,255,0.1)'"
                  onblur="this.style.borderColor='rgba(255,255,255,0.06)'"></textarea>
      </div>
      <!-- Footer -->
      <div class="px-5 py-3 flex-shrink-0" style="border-top: 1px solid var(--shell-border)">
        <button @click="copyDirection()"
                class="w-full py-2.5 rounded text-white text-center"
                style="background: var(--shell-accent); font-size: 13px; font-weight: 600; border-radius: var(--shell-radius-sm); transition: background 150ms"
                @mouseover="$el.style.background='var(--shell-accent-hover)'"
                @mouseout="$el.style.background='var(--shell-accent)'"
                x-text="copiedDirection ? '&#10003; Copied!' : 'Copy Direction'"></button>
      </div>
    </div>
  </div>

  <!-- ==================== KEYBOARD SHORTCUTS OVERLAY ==================== -->
  <div x-show="showShortcuts" class="fixed inset-0 z-50 flex items-center justify-center"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0">
    <div class="absolute inset-0" style="background: rgba(0,0,0,0.5); backdrop-filter: blur(4px)" @click="showShortcuts = false"></div>
    <div class="relative p-5" style="width: 420px; background: var(--shell-bg-raised); border: 1px solid var(--shell-border); border-radius: var(--shell-radius); box-shadow: 0 4px 24px rgba(0,0,0,0.4)">
      <div class="flex items-center justify-between mb-4">
        <span style="color: var(--shell-text-bright); font-size: 15px; font-weight: 600">Keyboard Shortcuts</span>
        <button @click="showShortcuts = false"
                style="color: var(--shell-text-dim); font-size: 20px; background: none; border: none; cursor: pointer">&times;</button>
      </div>
      <div class="grid grid-cols-2 gap-3" style="font-size: 13px">
        <template x-for="s in [
          ['\u2190 \u2192', 'Previous / Next'],
          ['0', 'Skip (mark as skip)'],
          ['1-5', 'Rate (stars)'],
          ['L', 'Toggle Tune'],
          ['R', 'Reload Variation'],
          ['E', 'Open Export'],
          ['?', 'Show Shortcuts'],
          ['Esc', 'Close Panels']
        ]" :key="s[0]">
          <div class="flex items-center gap-3">
            <kbd class="inline-flex items-center justify-center px-2 py-1 rounded"
                 style="background: var(--shell-bg); border: 1px solid var(--shell-border); font-family: var(--shell-font-mono); font-size: 12px; color: var(--shell-text-bright); min-width: 32px; box-shadow: 0 1px 2px rgba(0,0,0,0.2)"
                 x-text="s[0]"></kbd>
            <span style="color: var(--shell-text)" x-text="s[1]"></span>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- ==================== VARIATION TEMPLATES ==================== -->
    <template id="tpl-a1" data-body-class="min-h-screen flex flex-col items-center justify-start p-8 gap-12 bg-[#111111]">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "A1",
    "family": "A",
    "familyName": "Stacked Layers",
    "name": "Toolbar Stack",
    "layoutType": "Two-row horizontal",
    "aesthetic": "HZL Dark (shared)",
    "description": "Two distinct rows — top row has logo, filled tab buttons for views, connection status, and activity toggle. Bottom row has all contextual filters as full dropdowns. Bottom row hides entirely on views that don't need filters (like Agents).",
    "controls": [
      {
        "id": "tab-style",
        "label": "Tab Style",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Filled", "Bordered", "Ghost"],
        "cssValues": { "Filled": "var(--accent)", "Bordered": "transparent", "Ghost": "transparent" },
        "value": "Filled",
        "defaultValue": "Filled",
        "unit": "",
        "cssVar": "--tab-active-bg",
        "event": true
      },
      {
        "id": "row-gap",
        "label": "Row Gap",
        "type": "range",
        "min": 0, "max": 8, "step": 1,
        "options": null,
        "value": 0,
        "defaultValue": 0,
        "unit": "px",
        "cssVar": "--row-gap"
      },
      {
        "id": "filter-height",
        "label": "Filter Row Height",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Compact", "Comfortable"],
        "cssValues": { "Compact": "36px", "Comfortable": "48px" },
        "value": "Compact",
        "defaultValue": "Compact",
        "unit": "",
        "cssVar": "--filter-row-height"
      },
      {
        "id": "tab-gap",
        "label": "Tab Spacing",
        "type": "range",
        "min": 0, "max": 8, "step": 2,
        "options": null,
        "value": 4,
        "defaultValue": 4,
        "unit": "px",
        "cssVar": "--tab-gap"
      },
      {
        "id": "active-indicator",
        "label": "Active Indicator",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Background Fill", "Bottom Border", "Dot Badge"],
        "cssValues": { "Background Fill": "none", "Bottom Border": "2px solid var(--accent)", "Dot Badge": "none" },
        "value": "Background Fill",
        "defaultValue": "Background Fill",
        "unit": "",
        "cssVar": "--tab-indicator-border",
        "event": true
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;

      --tab-active-bg: var(--accent);
      --tab-gap: 4px;
      --row-gap: 0px;
      --filter-row-height: 36px;
      --tab-indicator-border: none;

      --font-mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease,
                  height 0.3s ease, max-height 0.35s ease,
                  opacity 0.3s ease, transform 0.3s ease;
    }

    body {
      font-family: var(--font-mono);
      font-size: 13px;
      background: #111111;
      color: var(--text-primary);
    }

    .header-wrapper {
      display: flex;
      flex-direction: column;
      gap: var(--row-gap);
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    /* Row 1 */
    .header-row-1 {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 12px;
      height: 44px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .logo {
      font-size: 14px;
      font-weight: 700;
      color: var(--accent);
      font-family: var(--font-mono);
      letter-spacing: -0.03em;
      flex-shrink: 0;
      margin-right: 4px;
    }

    .tab-nav {
      display: flex;
      align-items: center;
      gap: var(--tab-gap);
      flex: 1;
    }

    /* Tab base styles — active appearance controlled via JS classes */
    .tab-btn {
      position: relative;
      font-family: var(--font-mono);
      font-size: 12px;
      font-weight: 500;
      padding: 4px 10px;
      border-radius: 5px;
      border: 1px solid transparent;
      cursor: pointer;
      white-space: nowrap;
      background: transparent;
      color: var(--text-secondary);
      outline: none;
      overflow: hidden;
    }

    .tab-btn:hover {
      color: var(--text-primary);
      background: color-mix(in srgb, var(--text-primary) 6%, transparent);
    }

    /* Filled style (default) */
    .tab-btn.active.style-filled {
      background: var(--tab-active-bg);
      color: #0a0a0a;
      border-color: transparent;
    }

    /* Bordered style */
    .tab-btn.active.style-bordered {
      background: transparent;
      color: var(--accent);
      border-color: var(--accent);
    }

    /* Ghost style */
    .tab-btn.active.style-ghost {
      background: transparent;
      color: var(--accent);
      border-color: transparent;
    }

    /* Bottom border indicator */
    .tab-btn.indicator-bottom::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
      border-radius: 2px 2px 0 0;
    }

    /* Dot badge indicator */
    .tab-btn.indicator-dot::before {
      content: '';
      position: absolute;
      top: 4px;
      right: 4px;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--accent);
    }

    .global-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .conn-status {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .conn-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--status-done);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--status-done) 25%, transparent);
      flex-shrink: 0;
    }

    .activity-btn {
      font-family: var(--font-mono);
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 5px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
    }
    .activity-btn:hover {
      color: var(--text-primary);
      border-color: color-mix(in srgb, var(--border) 140%, transparent);
    }

    /* Row 2 — filter row */
    .header-row-2 {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 12px;
      height: var(--filter-row-height);
      background: var(--bg-secondary);
      border-top: 1px solid color-mix(in srgb, var(--border) 60%, transparent);
      overflow: hidden;
      flex-shrink: 0;
    }

    .header-row-2.hidden-row {
      height: 0;
      border-top-width: 0;
      padding-top: 0;
      padding-bottom: 0;
      opacity: 0;
      pointer-events: none;
    }

    .filter-select {
      font-family: var(--font-mono);
      font-size: 12px;
      padding: 0 8px;
      height: calc(var(--filter-row-height) - 10px);
      min-height: 24px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23737373'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 7px center;
      padding-right: 22px;
      white-space: nowrap;
    }
    .filter-select:hover {
      border-color: color-mix(in srgb, var(--border) 160%, transparent);
      color: var(--text-primary);
    }

    .filter-search {
      font-family: var(--font-mono);
      font-size: 12px;
      padding: 0 8px;
      height: calc(var(--filter-row-height) - 10px);
      min-height: 24px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-primary);
      flex: 1;
      min-width: 80px;
      outline: none;
    }
    .filter-search::placeholder {
      color: var(--text-muted);
    }
    .filter-search:focus {
      border-color: color-mix(in srgb, var(--accent) 50%, transparent);
    }

    .settings-btn {
      font-family: var(--font-mono);
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: calc(var(--filter-row-height) - 10px);
      min-width: 24px;
      height: calc(var(--filter-row-height) - 10px);
      min-height: 24px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      flex-shrink: 0;
    }
    .settings-btn:hover {
      color: var(--text-primary);
      border-color: color-mix(in srgb, var(--border) 160%, transparent);
    }

    /* Mobile */
    .mobile-filter-bar {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 10px;
      height: var(--filter-row-height);
      background: var(--bg-secondary);
      border-top: 1px solid color-mix(in srgb, var(--border) 60%, transparent);
      overflow: hidden;
    }

    .mobile-filter-bar.hidden-row {
      height: 0;
      border-top-width: 0;
      opacity: 0;
      pointer-events: none;
    }

    .filter-icon-btn {
      position: relative;
      display: flex;
      align-items: center;
      gap: 5px;
      font-family: var(--font-mono);
      font-size: 12px;
      padding: 0 9px;
      height: calc(var(--filter-row-height) - 10px);
      min-height: 24px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
    }

    .filter-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background: var(--bg-primary);
      color: var(--text-muted);
      font-size: 10px;
      font-weight: 600;
      line-height: 1;
    }

    .mobile-search {
      flex: 1;
      font-family: var(--font-mono);
      font-size: 12px;
      padding: 0 8px;
      height: calc(var(--filter-row-height) - 10px);
      min-height: 24px;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-card);
      color: var(--text-primary);
      outline: none;
    }
    .mobile-search::placeholder {
      color: var(--text-muted);
    }

    .section-label {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    /* Entrance animation */
    @keyframes fadeSlideDown {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .anim-in {
      animation: fadeSlideDown 0.35s ease both;
    }
    .anim-delay-1 { animation-delay: 0.05s; }
    .anim-delay-2 { animation-delay: 0.12s; }
    .anim-delay-3 { animation-delay: 0.19s; }

    /* Content area placeholder */
    .content-placeholder {
      background: var(--bg-primary);
      border-radius: 0 0 6px 6px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      padding: 10px;
    }

    .kanban-col {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 8px;
    }

    .kanban-col-label {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .kanban-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 8px;
      margin-bottom: 5px;
      font-size: 11px;
      color: var(--text-secondary);
      line-height: 1.4;
    }

    .kanban-card:last-child { margin-bottom: 0; }

    /* Mobile content placeholder */
    .mobile-content-placeholder {
      background: var(--bg-primary);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .mobile-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 8px 10px;
      font-size: 11px;
      color: var(--text-secondary);
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-8 gap-12 bg-[#111111]">

  <!-- Desktop Mockup -->
  <div class="w-full max-w-[1400px] anim-in">
    <div class="section-label">Desktop — 1400px</div>
    <div class="header-wrapper anim-in anim-delay-1" style="max-width:100%;">

      <!-- Row 1: Nav + Global -->
      <div class="header-row-1">
        <span class="logo">HZL</span>

        <nav class="tab-nav" id="desktop-tab-nav">
          <button class="tab-btn active style-filled" data-view="kanban">Kanban</button>
          <button class="tab-btn" data-view="calendar">Calendar</button>
          <button class="tab-btn" data-view="graph">Graph</button>
          <button class="tab-btn" data-view="agents">Agents</button>
        </nav>

        <div class="global-right">
          <div class="conn-status">
            <span class="conn-dot"></span>
            <span>Live</span>
          </div>
          <button class="activity-btn">Activity</button>
        </div>
      </div>

      <!-- Row 2: Filters (contextual, hidden for Agents) -->
      <div class="header-row-2" id="desktop-filter-row">
        <select class="filter-select" title="Date range">
          <option>Last 3 days</option>
          <option>Today</option>
          <option>Last 7 days</option>
          <option>Last 14 days</option>
          <option>Last 30 days</option>
        </select>

        <select class="filter-select" title="Project">
          <option>All projects</option>
          <option>hzl-core</option>
          <option>hzl-cli</option>
          <option>hzl-web</option>
        </select>

        <select class="filter-select" title="Agent">
          <option>Any Agent</option>
          <option>agent-alpha</option>
          <option>agent-beta</option>
        </select>

        <select class="filter-select" title="Tags">
          <option>All tags</option>
          <option>bug</option>
          <option>feat</option>
          <option>chore</option>
        </select>

        <input class="filter-search" type="text" placeholder="Find task (/)" />

        <button class="settings-btn" title="Settings">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M13.3 6.4l-.9-.5a5.3 5.3 0 0 0 0-1.8l.9-.5a1 1 0 0 0 .4-1.4L12.7 1a1 1 0 0 0-1.4-.4l-.9.5A5.3 5.3 0 0 0 8.9 1V0H7.1v1a5.3 5.3 0 0 0-1.5.6l-.9-.5A1 1 0 0 0 3.3 1L2.3 2.2a1 1 0 0 0 .4 1.4l.9.5a5.3 5.3 0 0 0 0 1.8l-.9.5a1 1 0 0 0-.4 1.4L3.3 9a1 1 0 0 0 1.4.4l.9-.5c.5.3 1 .5 1.5.6v1h1.8v-1c.5-.1 1-.3 1.5-.6l.9.5A1 1 0 0 0 12.7 9l1-1.2a1 1 0 0 0-.4-1.4z" stroke="currentColor" stroke-width="1.2" fill="none"/>
          </svg>
        </button>
      </div>

      <!-- Kanban content placeholder -->
      <div class="content-placeholder" id="desktop-content">
        <div class="kanban-col">
          <div class="kanban-col-label">Backlog</div>
          <div class="kanban-card">Refactor event store indexes</div>
          <div class="kanban-card">Add pagination to task list</div>
        </div>
        <div class="kanban-col">
          <div class="kanban-col-label">Ready</div>
          <div class="kanban-card">Fix claim race condition</div>
          <div class="kanban-card">Add `--available` filter docs</div>
          <div class="kanban-card">CI: add lint step</div>
        </div>
        <div class="kanban-col">
          <div class="kanban-col-label">In Progress</div>
          <div class="kanban-card">feat: agent ops PRD</div>
        </div>
        <div class="kanban-col">
          <div class="kanban-col-label">Done</div>
          <div class="kanban-card" style="color: var(--text-muted);">fix: harden event display</div>
          <div class="kanban-card" style="color: var(--text-muted);">refactor: move agent data fetching</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Mockup -->
  <div class="anim-in anim-delay-2" style="width:375px;">
    <div class="section-label">Mobile — 375px</div>
    <div class="header-wrapper anim-in anim-delay-3" style="width:375px;">

      <!-- Row 1: Logo + compact tabs + global right -->
      <div class="header-row-1" style="padding: 0 10px;">
        <span class="logo" style="font-size:13px;">HZL</span>

        <nav class="tab-nav" id="mobile-tab-nav" style="gap: var(--tab-gap); overflow-x: auto; scrollbar-width: none;">
          <button class="tab-btn active style-filled" data-view="kanban" style="padding: 3px 8px; font-size:11px;">Kanban</button>
          <button class="tab-btn" data-view="calendar" style="padding: 3px 8px; font-size:11px;">Calendar</button>
          <button class="tab-btn" data-view="graph" style="padding: 3px 8px; font-size:11px;">Graph</button>
          <button class="tab-btn" data-view="agents" style="padding: 3px 8px; font-size:11px;">Agents</button>
        </nav>

        <div class="global-right" style="gap:6px;">
          <div class="conn-status">
            <span class="conn-dot"></span>
          </div>
        </div>
      </div>

      <!-- Row 2 mobile: filter icon + search -->
      <div class="mobile-filter-bar" id="mobile-filter-row">
        <button class="filter-icon-btn" title="Filters">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 4h12M4 8h8M6 12h4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          Filters
          <span class="filter-badge">0</span>
        </button>
        <input class="mobile-search" type="text" placeholder="Find task (/)" />
        <button class="settings-btn" title="Settings" style="width: calc(var(--filter-row-height) - 10px); height: calc(var(--filter-row-height) - 10px);">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M13.3 6.4l-.9-.5a5.3 5.3 0 0 0 0-1.8l.9-.5a1 1 0 0 0 .4-1.4L12.7 1a1 1 0 0 0-1.4-.4l-.9.5A5.3 5.3 0 0 0 8.9 1V0H7.1v1a5.3 5.3 0 0 0-1.5.6l-.9-.5A1 1 0 0 0 3.3 1L2.3 2.2a1 1 0 0 0 .4 1.4l.9.5a5.3 5.3 0 0 0 0 1.8l-.9.5a1 1 0 0 0-.4 1.4L3.3 9a1 1 0 0 0 1.4.4l.9-.5c.5.3 1 .5 1.5.6v1h1.8v-1c.5-.1 1-.3 1.5-.6l.9.5A1 1 0 0 0 12.7 9l1-1.2a1 1 0 0 0-.4-1.4z" stroke="currentColor" stroke-width="1.2" fill="none"/>
          </svg>
        </button>
      </div>

      <!-- Mobile content placeholder -->
      <div class="mobile-content-placeholder">
        <div class="mobile-card">feat: agent ops PRD <span style="color:var(--accent);font-size:10px;float:right;">in-progress</span></div>
        <div class="mobile-card">Fix claim race condition <span style="color:var(--text-muted);font-size:10px;float:right;">ready</span></div>
        <div class="mobile-card">Add `--available` filter docs <span style="color:var(--text-muted);font-size:10px;float:right;">ready</span></div>
        <div class="mobile-card" style="color:var(--text-muted);">fix: harden event display <span style="color:var(--status-done);font-size:10px;float:right;">done</span></div>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------------------------------------------------
    // State
    // -----------------------------------------------------------------------
    let currentTabStyle = 'Filled';   // "Filled" | "Bordered" | "Ghost"
    let currentIndicator = 'Background Fill'; // "Background Fill" | "Bottom Border" | "Dot Badge"
    let currentView = 'kanban';

    // Style class maps
    const styleClassMap = {
      'Filled':   'style-filled',
      'Bordered': 'style-bordered',
      'Ghost':    'style-ghost',
    };

    const indicatorClassMap = {
      'Background Fill': '',
      'Bottom Border':   'indicator-bottom',
      'Dot Badge':       'indicator-dot',
    };

    // -----------------------------------------------------------------------
    // Apply tab appearance
    // -----------------------------------------------------------------------
    function applyTabAppearance() {
      const allTabs = document.querySelectorAll('.tab-btn');
      allTabs.forEach(btn => {
        // Remove all style classes
        btn.classList.remove('style-filled', 'style-bordered', 'style-ghost');
        // Remove all indicator classes
        btn.classList.remove('indicator-bottom', 'indicator-dot');

        if (btn.classList.contains('active')) {
          // Apply current style
          const styleClass = styleClassMap[currentTabStyle];
          if (styleClass) btn.classList.add(styleClass);

          // Apply indicator (only Bottom Border and Dot Badge add extra classes;
          // Background Fill is the default filled look)
          if (currentIndicator === 'Bottom Border') {
            // For bottom border, strip fill style and add border indicator
            btn.classList.remove('style-filled', 'style-bordered', 'style-ghost');
            btn.style.background = 'transparent';
            btn.style.color = 'var(--accent)';
            btn.style.borderColor = 'transparent';
            btn.classList.add('indicator-bottom');
          } else if (currentIndicator === 'Dot Badge') {
            // For dot badge, use ghost base + dot marker
            btn.classList.remove('style-filled', 'style-bordered', 'style-ghost');
            btn.style.background = 'transparent';
            btn.style.color = 'var(--accent)';
            btn.style.borderColor = 'transparent';
            btn.classList.add('indicator-dot');
          } else {
            // Background Fill — clear any inline overrides
            btn.style.background = '';
            btn.style.color = '';
            btn.style.borderColor = '';
          }
        } else {
          btn.style.background = '';
          btn.style.color = '';
          btn.style.borderColor = '';
        }
      });
    }

    // -----------------------------------------------------------------------
    // Filter row visibility (hide for Agents view)
    // -----------------------------------------------------------------------
    function updateFilterVisibility(view) {
      const desktopFilter = document.getElementById('desktop-filter-row');
      const mobileFilter  = document.getElementById('mobile-filter-row');
      const hidden = view === 'agents';
      desktopFilter.classList.toggle('hidden-row', hidden);
      mobileFilter.classList.toggle('hidden-row', hidden);
    }

    // -----------------------------------------------------------------------
    // Tab click handler (both desktop and mobile navs)
    // -----------------------------------------------------------------------
    function setupTabNav(navEl) {
      navEl.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          // Remove active from all tabs in ALL navs (desktop + mobile stay in sync)
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

          // Mark matching tabs active across both navs
          const view = btn.dataset.view;
          currentView = view;
          document.querySelectorAll(`.tab-btn[data-view="${view}"]`).forEach(b => b.classList.add('active'));

          applyTabAppearance();
          updateFilterVisibility(view);
        });
      });
    }

    setupTabNav(document.getElementById('desktop-tab-nav'));
    setupTabNav(document.getElementById('mobile-tab-nav'));

    // -----------------------------------------------------------------------
    // Control event handlers
    // -----------------------------------------------------------------------
    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;

      if (id === 'tab-style') {
        currentTabStyle = value;
        applyTabAppearance();
      }

      if (id === 'active-indicator') {
        currentIndicator = value;
        applyTabAppearance();
      }
    });

    document.addEventListener('controls-ready', () => {
      // Read initial CSS var values for event controls
      const style = getComputedStyle(document.documentElement);

      const tabActiveBg = style.getPropertyValue('--tab-active-bg').trim();
      if (tabActiveBg === 'var(--accent)') currentTabStyle = 'Filled';
      else if (tabActiveBg === 'transparent') currentTabStyle = 'Bordered'; // or Ghost — both map to transparent

      applyTabAppearance();
    });

    // -----------------------------------------------------------------------
    // Initial state
    // -----------------------------------------------------------------------
    applyTabAppearance();
    updateFilterVisibility(currentView);
  </script>
</body>
</html>

  </template>
  <template id="tpl-a2">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "A2",
    "family": "A",
    "familyName": "Stacked Layers",
    "name": "Underline Tabs",
    "layoutType": "Two-row with underline nav",
    "aesthetic": "HZL Dark (shared)",
    "description": "Two rows: top with underline-style text tabs, bottom with compact pill-shaped filter chips. Lighter, editorial feel.",
    "controls": [
      {
        "id": "underline-thickness",
        "label": "Underline Thickness",
        "type": "range",
        "min": 1,
        "max": 4,
        "step": 1,
        "options": null,
        "value": 2,
        "defaultValue": 2,
        "unit": "px",
        "cssVar": "--underline-thickness"
      },
      {
        "id": "tab-case",
        "label": "Uppercase Tabs",
        "type": "toggle",
        "min": null,
        "max": null,
        "step": null,
        "options": null,
        "cssValues": { "true": "uppercase", "false": "none" },
        "value": false,
        "defaultValue": false,
        "unit": "",
        "cssVar": "--tab-text-transform"
      },
      {
        "id": "chip-style",
        "label": "Chip Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Outlined", "Filled", "Ghost"],
        "cssValues": { "Outlined": "transparent", "Filled": "var(--bg-card)", "Ghost": "transparent" },
        "value": "Outlined",
        "defaultValue": "Outlined",
        "unit": "",
        "cssVar": "--chip-bg",
        "event": true
      },
      {
        "id": "row-separator",
        "label": "Row Separator",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Line", "Shadow", "Gap"],
        "cssValues": { "Line": "1px solid var(--border)", "Shadow": "none", "Gap": "none" },
        "value": "Line",
        "defaultValue": "Line",
        "unit": "",
        "cssVar": "--row-separator"
      },
      {
        "id": "tab-spacing",
        "label": "Tab Spacing",
        "type": "range",
        "min": 16,
        "max": 40,
        "step": 4,
        "options": null,
        "value": 24,
        "defaultValue": 24,
        "unit": "px",
        "cssVar": "--tab-spacing"
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;

      --underline-thickness: 2px;
      --tab-text-transform: none;
      --chip-bg: transparent;
      --chip-border: 1px solid var(--border);
      --row-separator: 1px solid var(--border);
      --tab-spacing: 24px;
      --row-gap: 0px;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease,
                  border-bottom-width 0.3s ease, margin 0.3s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
      font-size: 13px;
      background: #111;
      color: var(--text-primary);
      margin: 0;
      padding: 32px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 48px;
    }

    .mockup-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 10px;
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
    }

    /* Nav header */
    .nav-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
    }

    /* Row 1: Brand + tabs */
    .row-1 {
      background: var(--bg-primary);
      border-bottom: var(--row-separator);
      box-shadow: none;
      display: flex;
      align-items: stretch;
      padding: 0 24px;
      height: 44px;
    }

    .row-1-shadow {
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    /* Row 2: Filters */
    .row-2 {
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      padding: 0 24px;
      height: 40px;
      gap: 8px;
    }

    /* Brand */
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding-right: 28px;
      border-right: 1px solid var(--border);
      margin-right: 4px;
      flex-shrink: 0;
    }

    .brand-logo {
      color: var(--accent);
      font-weight: 700;
      font-size: 14px;
      letter-spacing: -0.02em;
    }

    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--status-done);
      display: inline-block;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .live-text {
      font-size: 11px;
      color: var(--status-done);
      font-weight: 500;
    }

    /* Tab nav */
    .tab-nav {
      display: flex;
      align-items: stretch;
      gap: var(--tab-spacing);
      flex: 1;
    }

    .tab-item {
      display: flex;
      align-items: center;
      position: relative;
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 400;
      text-transform: var(--tab-text-transform);
      letter-spacing: 0.01em;
      padding: 0;
      border: none;
      background: transparent;
      font-family: inherit;
      white-space: nowrap;
      transition: color 0.2s ease;
    }

    .tab-item::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: var(--underline-thickness);
      background: var(--accent);
      opacity: 0;
      transition: opacity 0.2s ease, height 0.3s ease;
    }

    .tab-item:hover {
      color: var(--text-primary);
    }

    .tab-item.active {
      color: var(--text-primary);
      font-weight: 700;
    }

    .tab-item.active::after {
      opacity: 1;
    }

    /* Right side actions */
    .row-1-actions {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: auto;
      flex-shrink: 0;
    }

    .activity-btn {
      font-size: 12px;
      color: var(--text-secondary);
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 10px;
      cursor: pointer;
      font-family: inherit;
      transition: color 0.2s ease, border-color 0.2s ease, background 0.2s ease;
    }

    .activity-btn:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
    }

    /* Filter chips */
    .chip {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--chip-bg);
      border: var(--chip-border);
      border-radius: 999px;
      padding: 3px 10px;
      cursor: pointer;
      font-family: inherit;
      white-space: nowrap;
      position: relative;
      transition: color 0.2s ease, background 0.2s ease, border-color 0.2s ease;
    }

    .chip:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
    }

    .chip-value {
      color: var(--text-primary);
      font-weight: 500;
    }

    .chip-caret {
      color: var(--text-muted);
      font-size: 10px;
      line-height: 1;
    }

    /* Search */
    .search-chip {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-muted);
      background: var(--chip-bg);
      border: var(--chip-border);
      border-radius: 999px;
      padding: 3px 12px;
      cursor: text;
      font-family: inherit;
      min-width: 160px;
      transition: border-color 0.2s ease, background 0.2s ease;
    }

    .search-chip:hover {
      border-color: var(--text-muted);
    }

    .search-icon {
      font-size: 11px;
      opacity: 0.6;
    }

    .search-placeholder {
      font-size: 12px;
      color: var(--text-muted);
    }

    .search-shortcut {
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 1px 4px;
      margin-left: auto;
    }

    /* Gear button */
    .gear-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: transparent;
      border: 1px solid var(--border);
      cursor: pointer;
      color: var(--text-muted);
      font-size: 14px;
      transition: color 0.2s ease, border-color 0.2s ease, transform 0.3s ease;
      flex-shrink: 0;
    }

    .gear-btn:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
      transform: rotate(30deg);
    }

    /* Chip separator dot */
    .chip-sep {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: var(--border);
      flex-shrink: 0;
    }

    /* Desktop mockup frame */
    .desktop-frame {
      width: 100%;
      max-width: 960px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: 0 8px 40px rgba(0,0,0,0.5);
    }

    /* Mobile mockup frame */
    .mobile-frame {
      width: 375px;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: 0 8px 40px rgba(0,0,0,0.5);
    }

    /* Mobile nav */
    .mobile-row-1 {
      background: var(--bg-primary);
      border-bottom: var(--row-separator);
      display: flex;
      align-items: center;
      padding: 0 16px;
      height: 44px;
      gap: 12px;
    }

    .mobile-row-2 {
      background: var(--bg-secondary);
      display: flex;
      align-items: center;
      padding: 0 16px;
      height: 40px;
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .mobile-row-2::-webkit-scrollbar { display: none; }

    .mobile-tab {
      display: flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-family: inherit;
      cursor: pointer;
      white-space: nowrap;
      text-transform: var(--tab-text-transform);
      border: 1px solid transparent;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .mobile-tab.active {
      background: color-mix(in srgb, var(--accent) 15%, transparent);
      border-color: color-mix(in srgb, var(--accent) 40%, transparent);
      color: var(--accent);
      font-weight: 600;
    }

    .mobile-tab:not(.active) {
      color: var(--text-secondary);
    }

    /* Mobile filter row */
    .mobile-filter-row {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 8px 16px;
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .mobile-filter-row::-webkit-scrollbar { display: none; }

    .filter-icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 28px;
      border-radius: 6px;
      background: var(--chip-bg);
      border: var(--chip-border);
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      flex-shrink: 0;
      transition: color 0.2s ease, border-color 0.2s ease;
    }

    /* Preview content area */
    .preview-content {
      background: var(--bg-primary);
      padding: 20px 24px;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-content-inner {
      display: flex;
      gap: 10px;
      width: 100%;
    }

    .kanban-col {
      flex: 1;
      border-radius: 6px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      padding: 8px;
      min-height: 80px;
    }

    .kanban-col-header {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid var(--border);
    }

    .kanban-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 5px 7px;
      margin-bottom: 5px;
      font-size: 11px;
      color: var(--text-secondary);
    }

    .row-2-gap {
      height: var(--row-gap);
      background: var(--bg-primary);
    }

    /* Entrance animation */
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-in {
      animation: fadeInDown 0.35s ease forwards;
    }

    .animate-in-delay-1 { animation-delay: 0.05s; opacity: 0; }
    .animate-in-delay-2 { animation-delay: 0.12s; opacity: 0; }
    .animate-in-delay-3 { animation-delay: 0.18s; opacity: 0; }
    .animate-in-delay-4 { animation-delay: 0.24s; opacity: 0; }

    /* Ghost chip style */
    .chip.ghost-style {
      border-color: transparent !important;
    }

    .chip.outlined-style {
      border: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <!-- Desktop Mockup -->
  <div>
    <div class="mockup-label">Desktop &mdash; 1400px</div>
    <div class="desktop-frame">
      <div class="nav-header">
        <!-- Row 1: Brand + Tab Nav -->
        <div class="row-1 animate-in" id="desktop-row-1">
          <!-- Brand -->
          <div class="brand">
            <span class="brand-logo">HZL</span>
            <div style="display:flex;align-items:center;gap:5px;">
              <span class="live-dot"></span>
              <span class="live-text">Live</span>
            </div>
          </div>

          <!-- Tab Nav -->
          <nav class="tab-nav animate-in animate-in-delay-1" id="desktop-tab-nav">
            <button class="tab-item active" data-tab="kanban">Kanban</button>
            <button class="tab-item" data-tab="calendar">Calendar</button>
            <button class="tab-item" data-tab="graph">Graph</button>
            <button class="tab-item" data-tab="agents">Agents</button>
          </nav>

          <!-- Right actions -->
          <div class="row-1-actions">
            <button class="activity-btn">Activity</button>
          </div>
        </div>

        <!-- Row gap for "Gap" separator mode -->
        <div class="row-2-gap" id="desktop-row-gap"></div>

        <!-- Row 2: Filter Chips -->
        <div class="row-2 animate-in animate-in-delay-2" id="desktop-row-2">
          <!-- Date chip -->
          <div class="chip" id="chip-date" title="Date range filter">
            <span style="color:var(--text-muted);font-size:11px;">Date</span>
            <span class="chip-value">3d</span>
            <span class="chip-caret">&#9662;</span>
          </div>

          <div class="chip-sep"></div>

          <!-- Project chip -->
          <div class="chip" id="chip-project" title="Project filter">
            <span style="color:var(--text-muted);font-size:11px;">Project</span>
            <span class="chip-value">All projects</span>
            <span class="chip-caret">&#9662;</span>
          </div>

          <div class="chip-sep"></div>

          <!-- Agent chip -->
          <div class="chip" id="chip-agent" title="Agent filter">
            <span style="color:var(--text-muted);font-size:11px;">Agent</span>
            <span class="chip-value">Any Agent</span>
            <span class="chip-caret">&#9662;</span>
          </div>

          <div class="chip-sep"></div>

          <!-- Tags chip -->
          <div class="chip" id="chip-tags" title="Tags filter">
            <span style="color:var(--text-muted);font-size:11px;">Tags</span>
            <span class="chip-value">All tags</span>
            <span class="chip-caret">&#9662;</span>
          </div>

          <!-- Spacer -->
          <div style="flex:1;"></div>

          <!-- Search -->
          <div class="search-chip animate-in animate-in-delay-3">
            <span class="search-icon">&#9906;</span>
            <span class="search-placeholder">Find task</span>
            <span class="search-shortcut">/</span>
          </div>

          <!-- Gear -->
          <button class="gear-btn animate-in animate-in-delay-4" title="Settings">&#9881;</button>
        </div>
      </div>

      <!-- Preview content -->
      <div class="preview-content">
        <div class="preview-content-inner">
          <div class="kanban-col">
            <div class="kanban-col-header">Backlog</div>
            <div class="kanban-card">Fix auth token refresh</div>
            <div class="kanban-card">Add rate limiting</div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-header">Ready</div>
            <div class="kanban-card">Deploy staging env</div>
            <div class="kanban-card">Update API docs</div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-header">In Progress</div>
            <div class="kanban-card">Refactor event store</div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-header" style="color:var(--status-done);">Done</div>
            <div class="kanban-card" style="opacity:0.5;">Init hzl schema</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Mockup -->
  <div>
    <div class="mockup-label">Mobile &mdash; 375px</div>
    <div class="mobile-frame">
      <div class="nav-header">
        <!-- Mobile Row 1: Brand + right actions -->
        <div class="mobile-row-1">
          <span class="brand-logo">HZL</span>
          <div style="display:flex;align-items:center;gap:5px;">
            <span class="live-dot"></span>
            <span class="live-text">Live</span>
          </div>
          <div style="flex:1;"></div>
          <button class="activity-btn" style="font-size:11px;padding:3px 8px;">Activity</button>
        </div>

        <!-- Mobile Row 2: Scrollable tab pills -->
        <div class="mobile-row-2" id="mobile-tab-row">
          <button class="mobile-tab active" data-tab="kanban">Kanban</button>
          <button class="mobile-tab" data-tab="calendar">Calendar</button>
          <button class="mobile-tab" data-tab="graph">Graph</button>
          <button class="mobile-tab" data-tab="agents">Agents</button>
        </div>

        <!-- Mobile filter row: collapsed to single icon + active chip -->
        <div class="mobile-filter-row">
          <div class="filter-icon-btn" id="mobile-filter-btn" title="Filters">
            &#9776;
          </div>
          <div class="chip" style="font-size:11px;padding:2px 9px;">
            <span style="color:var(--text-muted);font-size:10px;">Date</span>
            <span class="chip-value" style="font-size:11px;">3d</span>
          </div>
          <div class="chip" style="font-size:11px;padding:2px 9px;">
            <span class="chip-value" style="font-size:11px;">All projects</span>
          </div>
          <div class="chip" style="font-size:11px;padding:2px 9px;">
            <span class="chip-value" style="font-size:11px;">Any Agent</span>
          </div>
        </div>
      </div>

      <!-- Mobile content preview -->
      <div class="preview-content" style="padding:12px;min-height:80px;">
        <div style="width:100%;display:flex;flex-direction:column;gap:6px;">
          <div class="kanban-col" style="min-height:auto;">
            <div class="kanban-col-header">In Progress</div>
            <div class="kanban-card">Refactor event store</div>
          </div>
          <div class="kanban-col" style="min-height:auto;">
            <div class="kanban-col-header">Ready</div>
            <div class="kanban-card">Deploy staging env</div>
            <div class="kanban-card">Update API docs</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab interaction — desktop
    document.querySelectorAll('#desktop-tab-nav .tab-item').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('#desktop-tab-nav .tab-item').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
      });
    });

    // Tab interaction — mobile
    document.querySelectorAll('#mobile-tab-row .mobile-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('#mobile-tab-row .mobile-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
      });
    });

    // Chip-style event control
    function applyChipStyle(value) {
      const chips = document.querySelectorAll('.chip, .search-chip, .filter-icon-btn');

      if (value === 'Outlined' || value === 'transparent') {
        // Check if it's outlined (transparent bg + border)
        // We distinguish by the cssValues: Outlined => transparent bg + border
        // Filled => var(--bg-card) bg + no border (we'll use the value passed)
      }

      // The cssVar is set by the shell to --chip-bg. We need to also control border.
      // Use the control-change id to distinguish
    }

    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;

      if (id === 'chip-style') {
        const chips = document.querySelectorAll('.chip, .search-chip, .filter-icon-btn');

        if (value === 'Outlined') {
          chips.forEach(c => {
            c.style.setProperty('border', '1px solid var(--border)');
          });
          document.documentElement.style.setProperty('--chip-border', '1px solid var(--border)');
        } else if (value === 'Filled') {
          chips.forEach(c => {
            c.style.setProperty('border', '1px solid transparent');
          });
          document.documentElement.style.setProperty('--chip-border', '1px solid transparent');
        } else if (value === 'Ghost') {
          chips.forEach(c => {
            c.style.setProperty('border', '1px solid transparent');
          });
          document.documentElement.style.setProperty('--chip-border', '1px solid transparent');
        }
      }

      if (id === 'row-separator') {
        // Handle shadow mode for row 1
        const row1 = document.getElementById('desktop-row-1');
        if (value === 'Shadow') {
          row1.style.boxShadow = '0 2px 8px rgba(0,0,0,0.4)';
        } else {
          row1.style.boxShadow = 'none';
        }

        // Handle gap mode for row separator
        const gap = document.getElementById('desktop-row-gap');
        if (value === 'Gap') {
          gap.style.height = '6px';
        } else {
          gap.style.height = '0px';
        }
      }
    });

    document.addEventListener('controls-ready', () => {
      // Read initial chip-style from CSS var
      const chipBg = getComputedStyle(document.documentElement)
        .getPropertyValue('--chip-bg').trim();
      // Default: outlined
      document.documentElement.style.setProperty('--chip-border', '1px solid var(--border)');
    });
  </script>
</body>
</html>

  </template>
  <template id="tpl-b1">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "B1",
    "family": "B",
    "familyName": "Compact Rail",
    "name": "Icon Rail",
    "layoutType": "Vertical icon sidebar + top bar",
    "aesthetic": "HZL Dark (shared)",
    "description": "A narrow 48px left rail with HZL logo at top, then 4 view icons stacked vertically. Active view has a left accent bar. Top bar spans full width for filters, search, connection status, and activity.",
    "controls": [
      {
        "id": "rail-width",
        "label": "Rail Width",
        "type": "range",
        "min": 40,
        "max": 64,
        "step": 4,
        "options": null,
        "value": 48,
        "defaultValue": 48,
        "unit": "px",
        "cssVar": "--rail-width"
      },
      {
        "id": "active-indicator",
        "label": "Active Indicator",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Left Bar", "Background Fill", "Icon Glow"],
        "cssValues": { "Left Bar": "3px", "Background Fill": "0px", "Icon Glow": "0px" },
        "value": "Left Bar",
        "defaultValue": "Left Bar",
        "unit": "",
        "cssVar": "--indicator-bar-width",
        "event": true
      },
      {
        "id": "icon-size",
        "label": "Icon Size",
        "type": "range",
        "min": 16,
        "max": 24,
        "step": 2,
        "options": null,
        "value": 20,
        "defaultValue": 20,
        "unit": "px",
        "cssVar": "--icon-size"
      },
      {
        "id": "bar-density",
        "label": "Filter Bar Density",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Compact", "Comfortable"],
        "cssValues": { "Compact": "40px", "Comfortable": "52px" },
        "value": "Compact",
        "defaultValue": "Compact",
        "unit": "",
        "cssVar": "--filter-bar-height"
      },
      {
        "id": "rail-position",
        "label": "Rail Position",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Left", "Right"],
        "cssValues": { "Left": "row", "Right": "row-reverse" },
        "value": "Left",
        "defaultValue": "Left",
        "unit": "",
        "cssVar": "--layout-direction"
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;
      --font-mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;

      --rail-width: 48px;
      --indicator-bar-width: 3px;
      --icon-size: 20px;
      --filter-bar-height: 40px;
      --layout-direction: row;

      /* Derived active state vars — updated by JS for event control */
      --active-bg: transparent;
      --active-glow: none;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease,
                  height 0.3s ease;
    }

    body {
      font-family: var(--font-mono);
      font-size: 13px;
      background: #111111;
      color: var(--text-primary);
      margin: 0;
      padding: 2rem;
    }

    .mockup-label {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 0.5rem;
    }

    /* Rail icon button */
    .rail-icon-btn {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: var(--rail-width);
      cursor: pointer;
      background: var(--active-bg, transparent);
      box-shadow: var(--active-glow, none);
    }

    .rail-icon-btn svg {
      width: var(--icon-size);
      height: var(--icon-size);
      transition: width 0.3s ease, height 0.3s ease;
    }

    .rail-icon-btn .accent-bar {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: var(--indicator-bar-width);
      height: 60%;
      background: var(--accent);
      border-radius: 0 2px 2px 0;
      transition: width 0.3s ease, opacity 0.3s ease;
    }

    /* Tooltip */
    .rail-tooltip {
      position: absolute;
      left: calc(var(--rail-width) + 6px);
      top: 50%;
      transform: translateY(-50%);
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-primary);
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 4px;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s ease;
      z-index: 50;
    }

    .rail-icon-btn:hover .rail-tooltip {
      opacity: 1;
    }

    /* For right-rail tooltip flip */
    .rail-right .rail-tooltip {
      left: auto;
      right: calc(var(--rail-width) + 6px);
    }

    /* Filter bar */
    .filter-bar {
      height: var(--filter-bar-height);
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 12px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      transition: height 0.3s ease;
    }

    .filter-select {
      height: 26px;
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0 6px;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .search-input {
      height: 26px;
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0 8px;
      outline: none;
      min-width: 120px;
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-input:focus {
      border-color: var(--accent-dim);
    }

    /* Kanban board preview */
    .kanban-col {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px;
      min-width: 120px;
      flex: 1;
    }

    .kanban-col-header {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 6px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border);
    }

    .kanban-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 8px;
      margin-bottom: 4px;
      font-size: 11px;
      color: var(--text-secondary);
      cursor: pointer;
      animation: cardIn 0.3s ease both;
    }

    .kanban-card:hover {
      border-color: var(--accent-dim);
      color: var(--text-primary);
    }

    @keyframes cardIn {
      from { opacity: 0; transform: translateY(4px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .kanban-card:nth-child(1) { animation-delay: 0.05s; }
    .kanban-card:nth-child(2) { animation-delay: 0.1s; }
    .kanban-card:nth-child(3) { animation-delay: 0.15s; }

    /* Mobile bottom tab bar */
    .mobile-tab-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      padding: 6px 0;
      cursor: pointer;
      position: relative;
    }

    .mobile-tab-btn.active::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 2px;
      background: var(--accent);
      border-radius: 0 0 2px 2px;
    }

    .mobile-tab-label {
      font-size: 9px;
      color: var(--text-muted);
      letter-spacing: 0.04em;
    }

    .mobile-tab-btn.active .mobile-tab-label {
      color: var(--accent);
    }

    /* Entrance animations */
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-8px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes slideInDown {
      from { opacity: 0; transform: translateY(-6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .anim-rail { animation: slideInLeft 0.4s ease both; }
    .anim-topbar { animation: slideInDown 0.4s ease 0.1s both; }
    .anim-content { animation: fadeIn 0.5s ease 0.25s both; }

    /* Gear button */
    .icon-btn {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      color: var(--text-muted);
      flex-shrink: 0;
    }

    .icon-btn:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
    }

    .activity-btn {
      height: 26px;
      padding: 0 10px;
      font-family: var(--font-mono);
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .activity-btn:hover {
      color: var(--text-primary);
      border-color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="flex flex-col items-center justify-start gap-12 overflow-auto min-h-screen">

    <!-- DESKTOP MOCKUP -->
    <div class="w-full max-w-[1200px]">
      <div class="mockup-label">Desktop — 1200px</div>
      <div
        class="w-full rounded-lg overflow-hidden"
        style="border: 1px solid var(--border); background: var(--bg-primary); height: 480px;"
      >
        <!-- Outer layout: rail + main, direction controlled by CSS var -->
        <div class="flex h-full" style="flex-direction: var(--layout-direction);">

          <!-- RAIL -->
          <div
            class="anim-rail flex flex-col flex-shrink-0 h-full"
            id="desktop-rail"
            style="width: var(--rail-width); background: #141414; border-right: 1px solid var(--border); transition: width 0.3s ease;"
          >
            <!-- Logo -->
            <div
              class="flex items-center justify-center flex-shrink-0"
              style="height: var(--rail-width); border-bottom: 1px solid var(--border);"
            >
              <span style="font-family: var(--font-mono); font-size: 13px; font-weight: 700; color: var(--accent); letter-spacing: -0.03em;">HZL</span>
            </div>

            <!-- Nav icons -->
            <div class="flex flex-col flex-1 pt-1">

              <!-- Kanban (active) -->
              <div class="rail-icon-btn active-view" data-view="kanban" title="Kanban">
                <div class="accent-bar" id="dt-kanban-bar"></div>
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--accent);">
                  <rect x="2" y="2" width="6" height="16" rx="1"/>
                  <rect x="10" y="2" width="4" height="10" rx="1"/>
                  <rect x="10" y="14" width="4" height="4" rx="1"/>
                  <rect x="16" y="2" width="2" height="7" rx="1"/>
                  <rect x="16" y="11" width="2" height="7" rx="1"/>
                </svg>
                <div class="rail-tooltip">Kanban</div>
              </div>

              <!-- Calendar -->
              <div class="rail-icon-btn" data-view="calendar" title="Calendar" style="color: var(--text-muted);">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                  <rect x="2" y="4" width="16" height="14" rx="2"/>
                  <line x1="6" y1="2" x2="6" y2="6"/>
                  <line x1="14" y1="2" x2="14" y2="6"/>
                  <line x1="2" y1="9" x2="18" y2="9"/>
                  <rect x="5" y="12" width="2" height="2" rx="0.5"/>
                  <rect x="9" y="12" width="2" height="2" rx="0.5"/>
                  <rect x="13" y="12" width="2" height="2" rx="0.5"/>
                </svg>
                <div class="accent-bar" style="opacity: 0; width: var(--indicator-bar-width);"></div>
                <div class="rail-tooltip">Calendar</div>
              </div>

              <!-- Graph -->
              <div class="rail-icon-btn" data-view="graph" title="Graph" style="color: var(--text-muted);">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="10" cy="10" r="2.5"/>
                  <circle cx="3" cy="5" r="2"/>
                  <circle cx="17" cy="5" r="2"/>
                  <circle cx="3" cy="15" r="2"/>
                  <circle cx="17" cy="15" r="2"/>
                  <line x1="7.7" y1="8.3" x2="4.9" y2="6.8"/>
                  <line x1="12.3" y1="8.3" x2="15.1" y2="6.8"/>
                  <line x1="7.7" y1="11.7" x2="4.9" y2="13.2"/>
                  <line x1="12.3" y1="11.7" x2="15.1" y2="13.2"/>
                </svg>
                <div class="accent-bar" style="opacity: 0; width: var(--indicator-bar-width);"></div>
                <div class="rail-tooltip">Graph</div>
              </div>

              <!-- Agents -->
              <div class="rail-icon-btn" data-view="agents" title="Agents" style="color: var(--text-muted);">
                <svg viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="8" cy="6" r="3"/>
                  <path d="M2 17c0-3.3 2.7-6 6-6s6 2.7 6 6"/>
                  <circle cx="15" cy="7" r="2.5"/>
                  <path d="M15 12c2.2 0 4 1.8 4 4"/>
                </svg>
                <div class="accent-bar" style="opacity: 0; width: var(--indicator-bar-width);"></div>
                <div class="rail-tooltip">Agents</div>
              </div>
            </div>

            <!-- Bottom spacer -->
            <div style="height: 12px;"></div>
          </div>
          <!-- END RAIL -->

          <!-- MAIN AREA (filter bar + content) -->
          <div class="flex flex-col flex-1 min-w-0">

            <!-- FILTER BAR (top bar) -->
            <div class="filter-bar anim-topbar flex-shrink-0" style="overflow-x: auto;">
              <!-- Filters -->
              <div class="filter-select">
                <span style="color: var(--text-muted); font-size: 11px;">Date:</span>&nbsp;Last 3 days&nbsp;▾
              </div>
              <div class="filter-select">
                <span style="color: var(--text-muted); font-size: 11px;">Project:</span>&nbsp;All projects&nbsp;▾
              </div>
              <div class="filter-select">
                <span style="color: var(--text-muted); font-size: 11px;">Agent:</span>&nbsp;Any Agent&nbsp;▾
              </div>
              <div class="filter-select">
                <span style="color: var(--text-muted); font-size: 11px;">Tags:</span>&nbsp;All tags&nbsp;▾
              </div>

              <div style="flex: 1;"></div>

              <!-- Search -->
              <input class="search-input" type="text" placeholder="Find task (/)" readonly />

              <!-- Spacer -->
              <div style="width: 8px; flex-shrink: 0;"></div>

              <!-- Connection status -->
              <div class="flex items-center gap-1 flex-shrink-0" style="font-size: 12px; color: var(--text-muted);">
                <div style="width: 7px; height: 7px; border-radius: 50%; background: var(--status-done); flex-shrink: 0;"></div>
                <span style="color: var(--text-secondary);">Live</span>
              </div>

              <!-- Activity button -->
              <button class="activity-btn">Activity</button>

              <!-- Settings -->
              <button class="icon-btn">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="8" cy="8" r="2.5"/>
                  <path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.1 3.1l1.4 1.4M11.5 11.5l1.4 1.4M3.1 12.9l1.4-1.4M11.5 4.5l1.4-1.4"/>
                </svg>
              </button>
            </div>
            <!-- END FILTER BAR -->

            <!-- KANBAN CONTENT -->
            <div class="flex-1 anim-content overflow-auto p-3" style="background: var(--bg-primary);">
              <div class="flex gap-3 h-full">

                <!-- Backlog -->
                <div class="kanban-col">
                  <div class="kanban-col-header">Backlog <span style="color: var(--text-muted);">4</span></div>
                  <div class="kanban-card">Design token audit</div>
                  <div class="kanban-card">Write migration guide</div>
                  <div class="kanban-card">Update CLI docs</div>
                  <div class="kanban-card">Add concurrency test</div>
                </div>

                <!-- Ready -->
                <div class="kanban-col">
                  <div class="kanban-col-header">Ready <span style="color: var(--text-muted);">3</span></div>
                  <div class="kanban-card">
                    <div style="color: var(--text-primary); margin-bottom: 3px;">Refactor projection engine</div>
                    <div style="font-size: 10px; color: var(--text-muted);">agent-4 · demo</div>
                  </div>
                  <div class="kanban-card">
                    <div style="color: var(--text-primary); margin-bottom: 3px;">Fix claim race condition</div>
                    <div style="font-size: 10px; color: var(--text-muted);">agent-2 · core</div>
                  </div>
                  <div class="kanban-card">Add WAL mode tests</div>
                </div>

                <!-- In Progress -->
                <div class="kanban-col">
                  <div class="kanban-col-header" style="border-bottom-color: var(--accent-dim);">In Progress <span style="color: var(--accent);">2</span></div>
                  <div class="kanban-card" style="border-left: 2px solid var(--accent); padding-left: 6px;">
                    <div style="color: var(--text-primary); margin-bottom: 3px;">Nav header exploration</div>
                    <div style="font-size: 10px; color: var(--text-muted);">agent-1 · web</div>
                    <div style="font-size: 10px; margin-top: 4px;">
                      <div style="background: var(--border); border-radius: 2px; height: 3px; overflow: hidden;">
                        <div style="width: 65%; height: 100%; background: var(--accent); border-radius: 2px;"></div>
                      </div>
                    </div>
                  </div>
                  <div class="kanban-card" style="border-left: 2px solid var(--accent-dim); padding-left: 6px;">
                    <div style="color: var(--text-primary); margin-bottom: 3px;">Agent ops PRD</div>
                    <div style="font-size: 10px; color: var(--text-muted);">agent-3 · ops</div>
                  </div>
                </div>

                <!-- Review -->
                <div class="kanban-col">
                  <div class="kanban-col-header">Review <span style="color: var(--text-muted);">1</span></div>
                  <div class="kanban-card">
                    <div style="color: var(--text-primary); margin-bottom: 3px;">XSS guard pass</div>
                    <div style="font-size: 10px; color: var(--text-muted);">agent-2 · web</div>
                  </div>
                </div>

                <!-- Done -->
                <div class="kanban-col">
                  <div class="kanban-col-header" style="color: var(--status-done);">Done <span style="color: var(--text-muted);">5</span></div>
                  <div class="kanban-card" style="opacity: 0.6;">formatDuration tests</div>
                  <div class="kanban-card" style="opacity: 0.6;">hzl serve command</div>
                  <div class="kanban-card" style="opacity: 0.6;">Event store migrations</div>
                </div>

              </div>
            </div>
            <!-- END KANBAN CONTENT -->

          </div>
          <!-- END MAIN AREA -->

        </div>
      </div>
    </div>
    <!-- END DESKTOP MOCKUP -->

    <!-- MOBILE MOCKUP -->
    <div style="width: 375px;">
      <div class="mockup-label">Mobile — 375px</div>
      <div
        class="rounded-lg overflow-hidden"
        style="border: 1px solid var(--border); background: var(--bg-primary); height: 640px; display: flex; flex-direction: column;"
      >
        <!-- Mobile top bar (simplified) -->
        <div
          class="flex-shrink-0 flex items-center gap-2 px-3"
          style="background: var(--bg-secondary); border-bottom: 1px solid var(--border); height: var(--filter-bar-height);"
        >
          <!-- Logo -->
          <span style="font-family: var(--font-mono); font-size: 13px; font-weight: 700; color: var(--accent);">HZL</span>
          <div style="width: 1px; height: 16px; background: var(--border);"></div>
          <!-- Compact filters -->
          <div class="filter-select" style="font-size: 11px;">Last 3 days&nbsp;▾</div>
          <div class="filter-select" style="font-size: 11px;">All projects&nbsp;▾</div>
          <div style="flex: 1;"></div>
          <!-- Live status -->
          <div class="flex items-center gap-1" style="font-size: 11px;">
            <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--status-done);"></div>
            <span style="color: var(--text-muted);">Live</span>
          </div>
          <button class="activity-btn" style="font-size: 11px; height: 24px; padding: 0 8px;">Activity</button>
        </div>

        <!-- Mobile content (scrollable) -->
        <div class="flex-1 overflow-auto p-3" style="background: var(--bg-primary);">
          <!-- Vertical card stack for mobile -->
          <div class="flex flex-col gap-3">

            <div style="font-size: 11px; color: var(--text-muted); letter-spacing: 0.06em; text-transform: uppercase;">Kanban — In Progress</div>

            <div class="kanban-card" style="border-left: 2px solid var(--accent); padding-left: 6px;">
              <div style="color: var(--text-primary); margin-bottom: 3px;">Nav header exploration</div>
              <div style="display: flex; justify-content: space-between; align-items: center; font-size: 10px; color: var(--text-muted);">
                <span>agent-1 · web</span>
                <span style="color: var(--accent);">65%</span>
              </div>
              <div style="margin-top: 4px; background: var(--border); border-radius: 2px; height: 3px; overflow: hidden;">
                <div style="width: 65%; height: 100%; background: var(--accent); border-radius: 2px;"></div>
              </div>
            </div>

            <div class="kanban-card" style="border-left: 2px solid var(--accent-dim); padding-left: 6px;">
              <div style="color: var(--text-primary); margin-bottom: 3px;">Agent ops PRD</div>
              <div style="font-size: 10px; color: var(--text-muted);">agent-3 · ops</div>
            </div>

            <div style="font-size: 11px; color: var(--text-muted); letter-spacing: 0.06em; text-transform: uppercase; margin-top: 4px;">Ready</div>

            <div class="kanban-card">
              <div style="color: var(--text-primary); margin-bottom: 3px;">Refactor projection engine</div>
              <div style="font-size: 10px; color: var(--text-muted);">agent-4 · demo</div>
            </div>

            <div class="kanban-card">
              <div style="color: var(--text-primary); margin-bottom: 3px;">Fix claim race condition</div>
              <div style="font-size: 10px; color: var(--text-muted);">agent-2 · core</div>
            </div>

            <div class="kanban-card">Add WAL mode tests</div>

            <div style="font-size: 11px; color: var(--text-muted); letter-spacing: 0.06em; text-transform: uppercase; margin-top: 4px;">Review</div>

            <div class="kanban-card">
              <div style="color: var(--text-primary); margin-bottom: 3px;">XSS guard pass</div>
              <div style="font-size: 10px; color: var(--text-muted);">agent-2 · web</div>
            </div>

          </div>
        </div>

        <!-- Mobile bottom tab bar -->
        <div
          class="flex-shrink-0 flex"
          style="background: #141414; border-top: 1px solid var(--border); height: 52px;"
        >
          <!-- Kanban (active) -->
          <div class="mobile-tab-btn active">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--accent);">
              <rect x="2" y="2" width="6" height="16" rx="1"/>
              <rect x="10" y="2" width="4" height="10" rx="1"/>
              <rect x="10" y="14" width="4" height="4" rx="1"/>
              <rect x="16" y="2" width="2" height="7" rx="1"/>
              <rect x="16" y="11" width="2" height="7" rx="1"/>
            </svg>
            <span class="mobile-tab-label" style="color: var(--accent);">Kanban</span>
          </div>

          <!-- Calendar -->
          <div class="mobile-tab-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-muted);">
              <rect x="2" y="4" width="16" height="14" rx="2"/>
              <line x1="6" y1="2" x2="6" y2="6"/>
              <line x1="14" y1="2" x2="14" y2="6"/>
              <line x1="2" y1="9" x2="18" y2="9"/>
              <rect x="5" y="12" width="2" height="2" rx="0.5"/>
              <rect x="9" y="12" width="2" height="2" rx="0.5"/>
              <rect x="13" y="12" width="2" height="2" rx="0.5"/>
            </svg>
            <span class="mobile-tab-label">Calendar</span>
          </div>

          <!-- Graph -->
          <div class="mobile-tab-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-muted);">
              <circle cx="10" cy="10" r="2.5"/>
              <circle cx="3" cy="5" r="2"/>
              <circle cx="17" cy="5" r="2"/>
              <circle cx="3" cy="15" r="2"/>
              <circle cx="17" cy="15" r="2"/>
              <line x1="7.7" y1="8.3" x2="4.9" y2="6.8"/>
              <line x1="12.3" y1="8.3" x2="15.1" y2="6.8"/>
              <line x1="7.7" y1="11.7" x2="4.9" y2="13.2"/>
              <line x1="12.3" y1="11.7" x2="15.1" y2="13.2"/>
            </svg>
            <span class="mobile-tab-label">Graph</span>
          </div>

          <!-- Agents -->
          <div class="mobile-tab-btn">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5" style="color: var(--text-muted);">
              <circle cx="8" cy="6" r="3"/>
              <path d="M2 17c0-3.3 2.7-6 6-6s6 2.7 6 6"/>
              <circle cx="15" cy="7" r="2.5"/>
              <path d="M15 12c2.2 0 4 1.8 4 4"/>
            </svg>
            <span class="mobile-tab-label">Agents</span>
          </div>
        </div>
        <!-- END MOBILE BOTTOM TAB BAR -->

      </div>
    </div>
    <!-- END MOBILE MOCKUP -->

  </div>

  <script>
    // Apply active indicator style based on the selected mode
    function applyActiveIndicator(mode) {
      const activeViews = document.querySelectorAll('.rail-icon-btn.active-view');
      const inactiveBars = document.querySelectorAll('.rail-icon-btn:not(.active-view) .accent-bar');

      activeViews.forEach(btn => {
        const bar = btn.querySelector('.accent-bar');

        if (mode === 'Background Fill') {
          // Show a subtle bg fill, hide the left bar
          btn.style.setProperty('background', 'color-mix(in srgb, var(--accent) 12%, transparent)');
          btn.style.setProperty('box-shadow', 'none');
          if (bar) { bar.style.opacity = '0'; }
        } else if (mode === 'Icon Glow') {
          // Glow on the icon, no bg, no bar
          btn.style.setProperty('background', 'transparent');
          btn.style.setProperty('box-shadow', '0 0 12px color-mix(in srgb, var(--accent) 40%, transparent)');
          if (bar) { bar.style.opacity = '0'; }
        } else {
          // Left Bar (default)
          btn.style.setProperty('background', 'transparent');
          btn.style.setProperty('box-shadow', 'none');
          if (bar) { bar.style.opacity = '1'; }
        }
      });

      // Inactive bars always hidden
      inactiveBars.forEach(bar => { bar.style.opacity = '0'; });
    }

    // Read initial state
    document.addEventListener('controls-ready', () => {
      const mode = getComputedStyle(document.documentElement)
        .getPropertyValue('--indicator-bar-width').trim();
      // We map by checking the var value:
      // "3px" = Left Bar, "0px" + we need to distinguish — use a data attr approach
      // Instead read from current select value via stored data
      const storedMode = document.documentElement.dataset.activeIndicator || 'Left Bar';
      applyActiveIndicator(storedMode);
    });

    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;
      if (id === 'active-indicator') {
        document.documentElement.dataset.activeIndicator = value;
        applyActiveIndicator(value);
      }
    });

    // Initialize default
    applyActiveIndicator('Left Bar');

    // Also handle rail border side on rail-position change
    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;
      if (id === 'rail-position') {
        const rail = document.getElementById('desktop-rail');
        if (!rail) return;
        if (value === 'row-reverse') {
          rail.style.borderRight = 'none';
          rail.style.borderLeft = '1px solid var(--border)';
          // Flip tooltips
          rail.querySelectorAll('.rail-tooltip').forEach(t => {
            t.style.left = 'auto';
            t.style.right = 'calc(var(--rail-width) + 6px)';
          });
          // Flip accent bars to right
          rail.querySelectorAll('.accent-bar').forEach(b => {
            b.style.left = 'auto';
            b.style.right = '0';
            b.style.borderRadius = '2px 0 0 2px';
          });
        } else {
          rail.style.borderRight = '1px solid var(--border)';
          rail.style.borderLeft = 'none';
          rail.querySelectorAll('.rail-tooltip').forEach(t => {
            t.style.left = 'calc(var(--rail-width) + 6px)';
            t.style.right = 'auto';
          });
          rail.querySelectorAll('.accent-bar').forEach(b => {
            b.style.left = '0';
            b.style.right = 'auto';
            b.style.borderRadius = '0 2px 2px 0';
          });
        }
      }
    });
  </script>
</body>
</html>

  </template>
  <template id="tpl-b2" data-body-class="min-h-screen flex flex-col items-center justify-start p-8 gap-12">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "B2",
    "family": "B",
    "familyName": "Compact Rail",
    "name": "Label Rail",
    "layoutType": "Vertical labeled sidebar + top bar",
    "aesthetic": "HZL Dark (shared)",
    "description": "A wider 120px left rail with the HZL logo at the top, then text-labeled view links stacked vertically. Active view has a filled background pill. Top bar holds contextual filters + search + connection + activity.",
    "controls": [
      {
        "id": "rail-width",
        "label": "Rail Width",
        "type": "range",
        "min": 100,
        "max": 160,
        "step": 10,
        "options": null,
        "value": 120,
        "defaultValue": 120,
        "unit": "px",
        "cssVar": "--rail-width"
      },
      {
        "id": "label-size",
        "label": "Label Size",
        "type": "range",
        "min": 11,
        "max": 14,
        "step": 1,
        "options": null,
        "value": 12,
        "defaultValue": 12,
        "unit": "px",
        "cssVar": "--label-size"
      },
      {
        "id": "active-style",
        "label": "Active Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Filled Background", "Left Accent Bar", "Underline"],
        "cssValues": {
          "Filled Background": "filled",
          "Left Accent Bar": "accent-bar",
          "Underline": "underline"
        },
        "value": "Filled Background",
        "defaultValue": "Filled Background",
        "unit": "",
        "cssVar": "--active-style",
        "event": true
      },
      {
        "id": "rail-divider",
        "label": "Rail Divider",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": ["Line", "Shadow", "None"],
        "cssValues": {
          "Line": "1px solid #404040",
          "Shadow": "2px 0 8px rgba(0,0,0,0.4)",
          "None": "none"
        },
        "value": "Line",
        "defaultValue": "Line",
        "unit": "",
        "cssVar": "--rail-divider"
      },
      {
        "id": "show-icons",
        "label": "Show Icons",
        "type": "toggle",
        "min": null,
        "max": null,
        "step": null,
        "options": null,
        "cssValues": { "true": "inline-flex", "false": "none" },
        "value": true,
        "defaultValue": true,
        "unit": "",
        "cssVar": "--icon-display"
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;
      --rail-width: 120px;
      --label-size: 12px;
      --active-style: filled;
      --rail-divider: 1px solid #404040;
      --icon-display: inline-flex;
      --font: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease;
    }

    body {
      font-family: var(--font);
      background-color: #111111;
      color: var(--text-primary);
    }

    .mockup-label {
      font-family: var(--font);
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .mockup-frame {
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }

    /* Desktop layout */
    .desktop-shell {
      display: flex;
      flex-direction: column;
      width: 100%;
      background: var(--bg-primary);
    }

    /* Rail */
    .nav-rail {
      width: var(--rail-width);
      min-width: var(--rail-width);
      max-width: var(--rail-width);
      background: var(--bg-secondary);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      position: relative;
    }

    .nav-rail-border-line {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      border-right: var(--rail-divider);
      pointer-events: none;
    }

    .nav-rail-shadow {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 0;
      box-shadow: var(--rail-divider);
      pointer-events: none;
    }

    .rail-logo {
      font-family: var(--font);
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.05em;
      text-align: center;
      padding: 18px 0 16px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .rail-nav {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 10px 8px;
      flex: 1;
    }

    .rail-nav-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: var(--label-size);
      font-family: var(--font);
      color: var(--text-secondary);
      text-decoration: none;
      position: relative;
      user-select: none;
      white-space: nowrap;
    }

    .rail-nav-item:hover {
      color: var(--text-primary);
      background: color-mix(in srgb, var(--bg-card) 60%, transparent);
    }

    .rail-nav-item .nav-icon {
      display: var(--icon-display);
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      opacity: 0.7;
    }

    /* Active states controlled by --active-style via JS */
    .rail-nav-item.active-filled {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .rail-nav-item.active-filled .nav-icon {
      opacity: 1;
    }

    .rail-nav-item.active-filled::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 60%;
      background: var(--accent);
      border-radius: 0 2px 2px 0;
    }

    .rail-nav-item.active-accent-bar {
      color: var(--text-primary);
      background: transparent;
    }

    .rail-nav-item.active-accent-bar::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 70%;
      background: var(--accent);
      border-radius: 0 2px 2px 0;
    }

    .rail-nav-item.active-accent-bar .nav-icon {
      opacity: 1;
      color: var(--accent);
    }

    .rail-nav-item.active-underline {
      color: var(--text-primary);
      background: transparent;
    }

    .rail-nav-item.active-underline::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 10px;
      right: 10px;
      height: 1.5px;
      background: var(--accent);
      border-radius: 1px;
    }

    .rail-nav-item.active-underline .nav-icon {
      opacity: 1;
    }

    /* Top bar */
    .top-bar {
      height: 44px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 12px;
      flex-shrink: 0;
    }

    .filter-dropdown {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 8px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
    }

    .filter-dropdown:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    .filter-label {
      font-size: 10px;
      color: var(--text-muted);
      margin-right: 2px;
    }

    .search-input {
      flex: 1;
      min-width: 120px;
      max-width: 200px;
      height: 28px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0 8px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      outline: none;
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    .search-input:focus {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    .top-bar-spacer {
      flex: 1;
    }

    .connection-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-muted);
    }

    .live-dot {
      width: 7px;
      height: 7px;
      background: var(--status-done);
      border-radius: 50%;
      box-shadow: 0 0 5px color-mix(in srgb, var(--status-done) 60%, transparent);
      animation: pulse-dot 2.4s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 4px;
      cursor: pointer;
      color: var(--text-muted);
      background: transparent;
    }

    .icon-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-secondary);
    }

    .activity-btn {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 4px 9px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      cursor: pointer;
    }

    .activity-btn:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    /* Main content area */
    .main-content {
      flex: 1;
      background: var(--bg-primary);
      padding: 16px;
      overflow: hidden;
    }

    .kanban-cols {
      display: flex;
      gap: 10px;
      height: 100%;
    }

    .kanban-col {
      flex: 1;
      min-width: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .col-header {
      font-size: 10px;
      font-family: var(--font);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding-bottom: 7px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .col-count {
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg-card);
      border-radius: 3px;
      padding: 1px 5px;
    }

    .kanban-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 8px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      cursor: pointer;
      animation: card-in 0.35s ease both;
    }

    .kanban-card:nth-child(1) { animation-delay: 0.05s; }
    .kanban-card:nth-child(2) { animation-delay: 0.1s; }
    .kanban-card:nth-child(3) { animation-delay: 0.15s; }
    .kanban-card:nth-child(4) { animation-delay: 0.2s; }

    @keyframes card-in {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .kanban-card:hover {
      border-color: var(--text-muted);
      color: var(--text-primary);
    }

    .card-title {
      font-size: 11px;
      color: var(--text-primary);
      margin-bottom: 5px;
      line-height: 1.4;
    }

    .card-meta {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .card-tag {
      font-size: 10px;
      color: var(--text-muted);
      background: var(--bg-secondary);
      border-radius: 3px;
      padding: 1px 5px;
    }

    .card-agent {
      font-size: 10px;
      color: var(--accent-dim);
    }

    /* Mobile layout */
    .mobile-shell {
      width: 375px;
      background: var(--bg-primary);
      display: flex;
      flex-direction: column;
    }

    .mobile-top-bar {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 8px 12px;
      display: flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }

    .mobile-logo {
      font-family: var(--font);
      font-size: 16px;
      font-weight: 700;
      color: var(--accent);
      letter-spacing: 0.05em;
      margin-right: 4px;
    }

    .mobile-search {
      flex: 1;
      height: 28px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0 8px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      outline: none;
    }

    .mobile-search::placeholder {
      color: var(--text-muted);
    }

    .mobile-content {
      flex: 1;
      overflow: hidden;
      padding: 12px;
    }

    .mobile-kanban {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .mobile-col-header {
      font-size: 10px;
      font-family: var(--font);
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 5px;
    }

    .mobile-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 8px 10px;
      font-size: 11px;
      font-family: var(--font);
      color: var(--text-secondary);
      animation: card-in 0.35s ease both;
    }

    .mobile-card-title {
      font-size: 11px;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    /* Mobile bottom nav */
    .mobile-bottom-nav {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: stretch;
      height: 54px;
      flex-shrink: 0;
    }

    .mobile-nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      cursor: pointer;
      position: relative;
      color: var(--text-muted);
      padding: 6px 4px;
    }

    .mobile-nav-item:hover {
      color: var(--text-secondary);
    }

    .mobile-nav-item.active {
      color: var(--accent);
    }

    .mobile-nav-item.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 20%;
      right: 20%;
      height: 2px;
      background: var(--accent);
      border-radius: 0 0 2px 2px;
    }

    .mobile-nav-icon {
      width: 18px;
      height: 18px;
    }

    .mobile-nav-label {
      font-size: 9px;
      font-family: var(--font);
      letter-spacing: 0.02em;
    }

    /* Entrance animation for rail items */
    .rail-nav-item {
      animation: rail-item-in 0.3s ease both;
    }
    .rail-nav-item:nth-child(1) { animation-delay: 0.05s; }
    .rail-nav-item:nth-child(2) { animation-delay: 0.1s; }
    .rail-nav-item:nth-child(3) { animation-delay: 0.15s; }
    .rail-nav-item:nth-child(4) { animation-delay: 0.2s; }

    @keyframes rail-item-in {
      from { opacity: 0; transform: translateX(-8px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .rail-logo {
      animation: fade-in 0.25s ease both;
    }

    @keyframes fade-in {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Divider rendering using box-shadow or border based on value */
    .rail-divider-el {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 0;
      /* Controlled by JS to apply either border-right or box-shadow */
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-8 gap-12">

  <!-- Desktop Mockup -->
  <div class="w-full max-w-5xl">
    <div class="mockup-label">Desktop — 1200px</div>
    <div class="mockup-frame" style="height: 420px;">
      <div class="desktop-shell" style="height: 100%; flex-direction: row;">

        <!-- Left Rail -->
        <div class="nav-rail" id="desktop-rail">
          <div class="rail-logo">HZL</div>
          <nav class="rail-nav" id="desktop-nav">
            <a class="rail-nav-item active-filled" data-view="kanban" href="#">
              <span class="nav-icon">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="1" y="1" width="3.5" height="10" rx="0.8" fill="currentColor" opacity="0.8"/>
                  <rect x="5.5" y="1" width="3.5" height="7" rx="0.8" fill="currentColor" opacity="0.8"/>
                  <rect x="10" y="1" width="3.5" height="5" rx="0.8" fill="currentColor" opacity="0.8"/>
                </svg>
              </span>
              <span>Kanban</span>
            </a>
            <a class="rail-nav-item" data-view="calendar" href="#">
              <span class="nav-icon">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect x="1" y="2" width="10" height="9" rx="1" stroke="currentColor" stroke-width="1" fill="none"/>
                  <line x1="1" y1="5" x2="11" y2="5" stroke="currentColor" stroke-width="0.8"/>
                  <line x1="4" y1="1" x2="4" y2="3.5" stroke="currentColor" stroke-width="1"/>
                  <line x1="8" y1="1" x2="8" y2="3.5" stroke="currentColor" stroke-width="1"/>
                </svg>
              </span>
              <span>Calendar</span>
            </a>
            <a class="rail-nav-item" data-view="graph" href="#">
              <span class="nav-icon">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="6" cy="6" r="1.5" fill="currentColor"/>
                  <circle cx="2" cy="2.5" r="1.2" fill="currentColor" opacity="0.7"/>
                  <circle cx="10" cy="2.5" r="1.2" fill="currentColor" opacity="0.7"/>
                  <circle cx="2" cy="9.5" r="1.2" fill="currentColor" opacity="0.7"/>
                  <circle cx="10" cy="9.5" r="1.2" fill="currentColor" opacity="0.7"/>
                  <line x1="3.2" y1="3.2" x2="4.8" y2="5" stroke="currentColor" stroke-width="0.7"/>
                  <line x1="8.8" y1="3.2" x2="7.2" y2="5" stroke="currentColor" stroke-width="0.7"/>
                  <line x1="3.2" y1="8.8" x2="4.8" y2="7" stroke="currentColor" stroke-width="0.7"/>
                  <line x1="8.8" y1="8.8" x2="7.2" y2="7" stroke="currentColor" stroke-width="0.7"/>
                </svg>
              </span>
              <span>Graph</span>
            </a>
            <a class="rail-nav-item" data-view="agents" href="#">
              <span class="nav-icon">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="4.5" cy="3.5" r="2" stroke="currentColor" stroke-width="0.8" fill="none"/>
                  <path d="M1 10c0-1.93 1.57-3.5 3.5-3.5S8 8.07 8 10" stroke="currentColor" stroke-width="0.8" fill="none"/>
                  <circle cx="9" cy="4" r="1.5" stroke="currentColor" stroke-width="0.8" fill="none" opacity="0.6"/>
                  <path d="M7.5 10c0-1.38 0.9-2.5 2-2.5" stroke="currentColor" stroke-width="0.8" fill="none" opacity="0.6"/>
                </svg>
              </span>
              <span>Agents</span>
            </a>
          </nav>
          <!-- Divider element — styled by JS -->
          <div id="rail-divider-el" class="rail-divider-el"></div>
        </div>

        <!-- Right side: top bar + content -->
        <div style="flex: 1; min-width: 0; display: flex; flex-direction: column;">
          <!-- Top bar -->
          <div class="top-bar">
            <!-- Filters -->
            <div class="filter-dropdown">
              <span class="filter-label">Date:</span>
              Last 3 days
              <svg width="8" height="8" viewBox="0 0 8 8" fill="none" style="margin-left:2px;opacity:0.5">
                <path d="M2 3l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="filter-dropdown">
              <span class="filter-label">Project:</span>
              All projects
              <svg width="8" height="8" viewBox="0 0 8 8" fill="none" style="margin-left:2px;opacity:0.5">
                <path d="M2 3l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="filter-dropdown">
              <span class="filter-label">Agent:</span>
              Any Agent
              <svg width="8" height="8" viewBox="0 0 8 8" fill="none" style="margin-left:2px;opacity:0.5">
                <path d="M2 3l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </div>
            <div class="filter-dropdown">
              <span class="filter-label">Tags:</span>
              All tags
              <svg width="8" height="8" viewBox="0 0 8 8" fill="none" style="margin-left:2px;opacity:0.5">
                <path d="M2 3l2 2 2-2" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </div>
            <input class="search-input" type="text" placeholder="Find task (/)">
            <div class="top-bar-spacer"></div>
            <!-- Connection + Activity -->
            <div class="connection-badge">
              <span class="live-dot"></span>
              <span>Live</span>
            </div>
            <div class="activity-btn">
              <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
                <path d="M1 5.5L3.5 8.5L10 2.5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Activity
            </div>
            <div class="icon-btn" title="Settings">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                <circle cx="7" cy="7" r="2" stroke="currentColor" stroke-width="1.2"/>
                <path d="M7 1v1.5M7 11.5V13M1 7h1.5M11.5 7H13M2.8 2.8l1.1 1.1M10.1 10.1l1.1 1.1M11.2 2.8l-1.1 1.1M3.9 10.1l-1.1 1.1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              </svg>
            </div>
          </div>

          <!-- Main content: Kanban board -->
          <div class="main-content">
            <div class="kanban-cols">
              <!-- Ready -->
              <div class="kanban-col">
                <div class="col-header">
                  Ready
                  <span class="col-count">3</span>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Implement token refresh flow</div>
                  <div class="card-meta">
                    <span class="card-tag">auth</span>
                    <span class="card-agent">@claude-1</span>
                  </div>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Add pagination to task list</div>
                  <div class="card-meta">
                    <span class="card-tag">core</span>
                  </div>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Fix broken dependency graph edge</div>
                  <div class="card-meta">
                    <span class="card-tag">bug</span>
                    <span class="card-tag">graph</span>
                  </div>
                </div>
              </div>
              <!-- In Progress -->
              <div class="kanban-col">
                <div class="col-header">
                  In Progress
                  <span class="col-count">2</span>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Migrate projections to WAL mode</div>
                  <div class="card-meta">
                    <span class="card-tag">db</span>
                    <span class="card-agent">@claude-2</span>
                  </div>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Write concurrency stress tests</div>
                  <div class="card-meta">
                    <span class="card-tag">test</span>
                    <span class="card-agent">@claude-3</span>
                  </div>
                </div>
              </div>
              <!-- Review -->
              <div class="kanban-col">
                <div class="col-header">
                  Review
                  <span class="col-count">1</span>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Refactor TaskService claim logic</div>
                  <div class="card-meta">
                    <span class="card-tag">refactor</span>
                    <span class="card-agent">@claude-1</span>
                  </div>
                </div>
              </div>
              <!-- Done -->
              <div class="kanban-col">
                <div class="col-header">
                  Done
                  <span class="col-count">4</span>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Add XDG path resolution</div>
                  <div class="card-meta">
                    <span class="card-tag">core</span>
                    <span style="font-size:10px;color:var(--status-done)">done</span>
                  </div>
                </div>
                <div class="kanban-card">
                  <div class="card-title">Setup monorepo workspace</div>
                  <div class="card-meta">
                    <span class="card-tag">infra</span>
                    <span style="font-size:10px;color:var(--status-done)">done</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Mobile Mockup -->
  <div>
    <div class="mockup-label">Mobile — 375px</div>
    <div class="mockup-frame" style="width: 375px; height: 580px;">
      <div class="mobile-shell" style="height: 100%;">

        <!-- Mobile Top Bar -->
        <div class="mobile-top-bar">
          <span class="mobile-logo">HZL</span>
          <input class="mobile-search" type="text" placeholder="Find task (/)">
          <div class="connection-badge" style="margin-left:4px;">
            <span class="live-dot"></span>
          </div>
          <div class="icon-btn" title="Settings">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <circle cx="7" cy="7" r="2" stroke="currentColor" stroke-width="1.2"/>
              <path d="M7 1v1.5M7 11.5V13M1 7h1.5M11.5 7H13M2.8 2.8l1.1 1.1M10.1 10.1l1.1 1.1M11.2 2.8l-1.1 1.1M3.9 10.1l-1.1 1.1" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
          </div>
        </div>

        <!-- Mobile Filter Strip -->
        <div style="background:var(--bg-primary);border-bottom:1px solid var(--border);padding:6px 12px;display:flex;gap:5px;overflow-x:auto;flex-shrink:0;scrollbar-width:none;">
          <div class="filter-dropdown" style="font-size:10px;padding:3px 7px;">Last 3 days</div>
          <div class="filter-dropdown" style="font-size:10px;padding:3px 7px;">All projects</div>
          <div class="filter-dropdown" style="font-size:10px;padding:3px 7px;">Any Agent</div>
          <div class="filter-dropdown" style="font-size:10px;padding:3px 7px;">All tags</div>
        </div>

        <!-- Mobile Kanban content -->
        <div class="mobile-content" style="overflow-y:auto; flex:1;">
          <div style="font-size:10px;font-family:var(--font);color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:8px;">Kanban — Ready (3)</div>
          <div class="mobile-kanban">
            <div class="mobile-card">
              <div class="mobile-card-title">Implement token refresh flow</div>
              <div class="card-meta"><span class="card-tag">auth</span><span class="card-agent">@claude-1</span></div>
            </div>
            <div class="mobile-card">
              <div class="mobile-card-title">Add pagination to task list</div>
              <div class="card-meta"><span class="card-tag">core</span></div>
            </div>
            <div class="mobile-card">
              <div class="mobile-card-title">Fix broken dependency graph edge</div>
              <div class="card-meta"><span class="card-tag">bug</span><span class="card-tag">graph</span></div>
            </div>
          </div>
          <div style="font-size:10px;font-family:var(--font);color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin:12px 0 8px;">In Progress (2)</div>
          <div class="mobile-kanban">
            <div class="mobile-card">
              <div class="mobile-card-title">Migrate projections to WAL mode</div>
              <div class="card-meta"><span class="card-tag">db</span><span class="card-agent">@claude-2</span></div>
            </div>
            <div class="mobile-card">
              <div class="mobile-card-title">Write concurrency stress tests</div>
              <div class="card-meta"><span class="card-tag">test</span><span class="card-agent">@claude-3</span></div>
            </div>
          </div>
        </div>

        <!-- Mobile Bottom Nav -->
        <div class="mobile-bottom-nav">
          <div class="mobile-nav-item active" data-view="kanban">
            <svg class="mobile-nav-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="2" width="5" height="14" rx="1" fill="currentColor" opacity="0.85"/>
              <rect x="9" y="2" width="5" height="10" rx="1" fill="currentColor" opacity="0.85"/>
            </svg>
            <span class="mobile-nav-label">Kanban</span>
          </div>
          <div class="mobile-nav-item" data-view="calendar">
            <svg class="mobile-nav-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="2" y="3" width="14" height="12" rx="1.5" stroke="currentColor" stroke-width="1.2" fill="none"/>
              <line x1="2" y1="7" x2="16" y2="7" stroke="currentColor" stroke-width="1"/>
              <line x1="6" y1="1.5" x2="6" y2="5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
              <line x1="12" y1="1.5" x2="12" y2="5" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
            </svg>
            <span class="mobile-nav-label">Calendar</span>
          </div>
          <div class="mobile-nav-item" data-view="graph">
            <svg class="mobile-nav-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="9" cy="9" r="2.5" fill="currentColor"/>
              <circle cx="3" cy="3.5" r="1.8" fill="currentColor" opacity="0.6"/>
              <circle cx="15" cy="3.5" r="1.8" fill="currentColor" opacity="0.6"/>
              <circle cx="3" cy="14.5" r="1.8" fill="currentColor" opacity="0.6"/>
              <circle cx="15" cy="14.5" r="1.8" fill="currentColor" opacity="0.6"/>
              <line x1="4.6" y1="4.7" x2="7.2" y2="7.5" stroke="currentColor" stroke-width="0.9"/>
              <line x1="13.4" y1="4.7" x2="10.8" y2="7.5" stroke="currentColor" stroke-width="0.9"/>
              <line x1="4.6" y1="13.3" x2="7.2" y2="10.5" stroke="currentColor" stroke-width="0.9"/>
              <line x1="13.4" y1="13.3" x2="10.8" y2="10.5" stroke="currentColor" stroke-width="0.9"/>
            </svg>
            <span class="mobile-nav-label">Graph</span>
          </div>
          <div class="mobile-nav-item" data-view="agents">
            <svg class="mobile-nav-icon" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="7" cy="5" r="2.8" stroke="currentColor" stroke-width="1.2" fill="none"/>
              <path d="M1.5 15c0-3 2.46-5.5 5.5-5.5S12.5 12 12.5 15" stroke="currentColor" stroke-width="1.2" fill="none"/>
              <circle cx="13.5" cy="6" r="2" stroke="currentColor" stroke-width="1" fill="none" opacity="0.6"/>
              <path d="M11 15c0-2 1.12-3.5 3-3.8" stroke="currentColor" stroke-width="1" fill="none" opacity="0.6"/>
            </svg>
            <span class="mobile-nav-label">Agents</span>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // Apply active style class to all desktop nav items
    function applyActiveStyle(styleValue) {
      const navItems = document.querySelectorAll('#desktop-nav .rail-nav-item');
      navItems.forEach(item => {
        item.classList.remove('active-filled', 'active-accent-bar', 'active-underline');
        if (item.dataset.view === 'kanban') {
          item.classList.add('active-' + styleValue);
        }
      });
    }

    // Apply rail divider
    function applyRailDivider(value) {
      const rail = document.getElementById('desktop-rail');
      if (!rail) return;
      // Reset
      rail.style.borderRight = '';
      rail.style.boxShadow = '';
      if (value === 'none' || !value) {
        // no divider
      } else if (value.startsWith('1px') || value.startsWith('2px solid')) {
        // It's a border
        rail.style.borderRight = value;
      } else if (value.includes('box-shadow') || value.includes('rgba')) {
        // It's a shadow — but CSS var sets the shadow string directly
        rail.style.boxShadow = value;
      }
    }

    // Listen for shell control events
    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;
      if (id === 'active-style') {
        applyActiveStyle(value);
      }
    });

    // controls-ready: read initial values from CSS
    document.addEventListener('controls-ready', () => {
      const styleVal = getComputedStyle(document.documentElement)
        .getPropertyValue('--active-style').trim();
      if (styleVal) applyActiveStyle(styleVal);
    });

    // Also watch for CSS var changes on --rail-divider via a MutationObserver trick
    // The shell sets CSS vars inline on :root. We poll on animation frame for divider.
    let lastDivider = null;
    function checkDivider() {
      const val = getComputedStyle(document.documentElement).getPropertyValue('--rail-divider').trim();
      if (val !== lastDivider) {
        lastDivider = val;
        const rail = document.getElementById('desktop-rail');
        if (rail) {
          rail.style.borderRight = '';
          rail.style.boxShadow = '';
          if (val && val !== 'none') {
            if (val.includes('solid')) {
              rail.style.borderRight = val;
            } else if (val.includes('rgba') || val.includes('px 0')) {
              rail.style.boxShadow = val;
            }
          }
        }
      }
      requestAnimationFrame(checkDivider);
    }
    requestAnimationFrame(checkDivider);

    // Init: apply default active style
    applyActiveStyle('filled');

    // Mobile bottom nav click interaction
    document.querySelectorAll('.mobile-nav-item').forEach(item => {
      item.addEventListener('click', () => {
        document.querySelectorAll('.mobile-nav-item').forEach(i => i.classList.remove('active'));
        item.classList.add('active');
      });
    });

    // Desktop rail nav click interaction
    document.querySelectorAll('#desktop-nav .rail-nav-item').forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        const styleVal = getComputedStyle(document.documentElement).getPropertyValue('--active-style').trim() || 'filled';
        document.querySelectorAll('#desktop-nav .rail-nav-item').forEach(i => {
          i.classList.remove('active-filled', 'active-accent-bar', 'active-underline');
        });
        item.classList.add('active-' + styleVal);
      });
    });
  </script>
</body>
</html>

  </template>
  <template id="tpl-c1">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "C1",
    "family": "C",
    "familyName": "Unified Bar",
    "name": "Segmented Control",
    "layoutType": "Single row with segmented switcher",
    "aesthetic": "HZL Dark (shared)",
    "description": "Everything in one header row — prominent segmented control for view switching, progressive disclosure for filters via dropdown panel, inline search.",
    "controls": [
      {
        "id": "segment-style",
        "label": "Segment Style",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Filled", "Outlined", "Pill"],
        "cssValues": { "Filled": "var(--bg-card)", "Outlined": "transparent", "Pill": "var(--bg-card)" },
        "value": "Filled",
        "defaultValue": "Filled",
        "unit": "",
        "cssVar": "--segment-active-bg",
        "event": true
      },
      {
        "id": "control-size",
        "label": "Control Size",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Compact", "Default", "Large"],
        "cssValues": { "Compact": "28px", "Default": "34px", "Large": "40px" },
        "value": "Default",
        "defaultValue": "Default",
        "unit": "",
        "cssVar": "--segment-height"
      },
      {
        "id": "filter-btn-style",
        "label": "Show Filter Label",
        "type": "toggle",
        "min": null, "max": null, "step": null,
        "options": null,
        "cssValues": { "true": "inline", "false": "none" },
        "value": true,
        "defaultValue": true,
        "unit": "",
        "cssVar": "--filter-label-display"
      },
      {
        "id": "segment-gap",
        "label": "Segment Gap",
        "type": "range",
        "min": 0, "max": 4, "step": 1,
        "options": null,
        "value": 0,
        "defaultValue": 0,
        "unit": "px",
        "cssVar": "--segment-gap"
      },
      {
        "id": "search-width",
        "label": "Search Width",
        "type": "range",
        "min": 120, "max": 220, "step": 20,
        "options": null,
        "value": 160,
        "defaultValue": 160,
        "unit": "px",
        "cssVar": "--search-width"
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;

      --segment-active-bg: var(--bg-card);
      --segment-height: 34px;
      --filter-label-display: inline;
      --segment-gap: 0px;
      --search-width: 160px;

      --segment-radius-filled: 5px;
      --segment-radius-pill: 999px;
      --segment-outer-radius: 6px;
      --segment-border-style: none;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease,
                  height 0.3s ease, opacity 0.3s ease;
    }

    body {
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
      font-size: 13px;
      background-color: #111111;
      color: var(--text-primary);
      margin: 0;
      padding: 32px 24px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 48px;
    }

    /* Segment control base */
    .segmented-control {
      display: flex;
      align-items: center;
      height: var(--segment-height);
      background-color: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--segment-outer-radius);
      padding: 3px;
      gap: var(--segment-gap);
      position: relative;
    }

    .segment-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: calc(var(--segment-height) - 6px);
      padding: 0 12px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      background: transparent;
      border: var(--segment-border-style);
      border-color: transparent;
      border-radius: var(--segment-active-radius, 4px);
      cursor: pointer;
      white-space: nowrap;
      transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
    }

    .segment-btn:hover {
      color: var(--text-primary);
    }

    .segment-btn.active {
      background-color: var(--segment-active-bg);
      color: var(--text-primary);
      border-color: var(--border);
    }

    /* Outlined style: active segment uses border only, no fill */
    .segmented-control.style-outlined .segment-btn.active {
      background-color: transparent;
      border: 1px solid var(--accent-dim);
      color: var(--accent);
    }

    /* Pill style: individual segments are pill shaped */
    .segmented-control.style-pill {
      border-radius: 999px;
      background-color: var(--bg-secondary);
    }

    .segmented-control.style-pill .segment-btn {
      border-radius: 999px;
    }

    .segmented-control.style-pill .segment-btn.active {
      background-color: var(--segment-active-bg);
      border-color: var(--border);
    }

    /* Header row */
    .hzl-header {
      height: 48px;
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 16px;
      gap: 12px;
    }

    /* Search input */
    .search-input {
      width: var(--search-width);
      height: calc(var(--segment-height) - 2px);
      background-color: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 5px;
      color: var(--text-primary);
      font-family: inherit;
      font-size: 12px;
      padding: 0 10px;
      outline: none;
      transition: width 0.3s ease, border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .search-input:focus {
      border-color: var(--accent-dim);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 15%, transparent);
      width: calc(var(--search-width) + 40px);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    /* Filter button */
    .filter-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      height: var(--segment-height);
      padding: 0 10px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      background-color: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 5px;
      cursor: pointer;
      white-space: nowrap;
      transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
    }

    .filter-btn:hover {
      color: var(--text-primary);
      border-color: color-mix(in srgb, var(--border) 150%, var(--text-secondary) 20%);
    }

    .filter-btn.active {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    .filter-label {
      display: var(--filter-label-display);
    }

    .filter-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background-color: var(--accent-dim);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      line-height: 1;
    }

    /* Icon button */
    .icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      width: var(--segment-height);
      height: var(--segment-height);
      background: transparent;
      border: 1px solid transparent;
      border-radius: 5px;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 14px;
      transition: color 0.2s ease, background-color 0.2s ease, border-color 0.2s ease;
    }

    .icon-btn:hover {
      color: var(--text-primary);
      background-color: var(--bg-card);
      border-color: var(--border);
    }

    /* Dropdown filter panel */
    .filter-dropdown {
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-top: none;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-select {
      display: flex;
      align-items: center;
      gap: 6px;
      background-color: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 0 10px;
      height: 30px;
      font-family: inherit;
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
    }

    .filter-select-label {
      color: var(--text-muted);
      font-size: 11px;
    }

    .filter-select-value {
      color: var(--text-primary);
    }

    .filter-select-arrow {
      color: var(--text-muted);
      font-size: 10px;
      margin-left: 4px;
    }

    .filter-divider {
      width: 1px;
      height: 20px;
      background-color: var(--border);
    }

    .filter-clear-btn {
      background: transparent;
      border: none;
      color: var(--text-muted);
      font-family: inherit;
      font-size: 11px;
      cursor: pointer;
      padding: 0 4px;
      margin-left: auto;
      transition: color 0.2s ease;
    }

    .filter-clear-btn:hover {
      color: var(--text-primary);
    }

    /* Connection status */
    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background-color: var(--status-done);
      box-shadow: 0 0 4px var(--status-done);
      flex-shrink: 0;
    }

    /* Logo */
    .hzl-logo {
      color: var(--accent);
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0.05em;
      flex-shrink: 0;
    }

    /* Section label */
    .section-label {
      font-size: 11px;
      color: var(--text-muted);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 12px;
      font-weight: 600;
    }

    /* Spacer */
    .spacer { flex: 1; }

    /* Mockup container */
    .mockup-block {
      display: flex;
      flex-direction: column;
      gap: 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 32px rgba(0,0,0,0.5);
    }

    .mockup-body {
      background-color: var(--bg-primary);
      padding: 20px 16px;
      min-height: 120px;
    }

    /* Kanban preview */
    .kanban-preview {
      display: flex;
      gap: 10px;
    }

    .kanban-col {
      flex: 1;
      min-width: 0;
      background-color: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
    }

    .kanban-col-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
    }

    .kanban-card {
      background-color: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 8px 10px;
      margin-bottom: 6px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .kanban-card-title {
      color: var(--text-primary);
      font-size: 12px;
      margin-bottom: 4px;
      line-height: 1.3;
    }

    .kanban-card-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Entrance animation */
    @keyframes fadeSlideIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    .animate-header {
      animation: fadeSlideIn 0.4s ease both;
    }

    .animate-filter-panel {
      animation: fadeSlideIn 0.35s ease 0.1s both;
    }

    .animate-body {
      animation: fadeIn 0.5s ease 0.2s both;
    }

    /* Mobile compact */
    .mobile-segment-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      height: calc(var(--segment-height) - 6px);
      width: 32px;
      font-family: inherit;
      font-size: 13px;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      border-radius: var(--segment-active-radius, 4px);
      cursor: pointer;
    }

    .mobile-segment-btn.active {
      background-color: var(--segment-active-bg);
      color: var(--text-primary);
    }

    .mobile-header {
      height: 44px;
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 8px;
    }
  </style>
</head>
<body>

  <!-- ============================================================ -->
  <!-- DESKTOP MOCKUP                                               -->
  <!-- ============================================================ -->
  <div style="width: 100%; max-width: 900px;">
    <div class="section-label">Desktop — 1400px</div>

    <div class="mockup-block" style="width: 100%;">

      <!-- Header Row -->
      <div class="hzl-header animate-header">
        <!-- Logo -->
        <span class="hzl-logo">HZL</span>

        <div style="width: 1px; height: 18px; background: var(--border); flex-shrink: 0;"></div>

        <!-- Segmented Control -->
        <div class="segmented-control" id="desktop-seg-control">
          <button class="segment-btn" data-view="Kanban">Kanban</button>
          <button class="segment-btn active" data-view="Calendar">Calendar</button>
          <button class="segment-btn" data-view="Graph">Graph</button>
          <button class="segment-btn" data-view="Agents">Agents</button>
        </div>

        <!-- Filters Button -->
        <button class="filter-btn" id="desktop-filter-btn">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
            <line x1="1" y1="3" x2="11" y2="3"/>
            <line x1="3" y1="6" x2="9" y2="6"/>
            <line x1="5" y1="9" x2="7" y2="9"/>
          </svg>
          <span class="filter-label">Filters</span>
          <span class="filter-badge" style="display: none;">2</span>
        </button>

        <div class="spacer"></div>

        <!-- Search -->
        <input class="search-input" type="text" placeholder="Find task (/)" />

        <div style="width: 1px; height: 18px; background: var(--border); flex-shrink: 0;"></div>

        <!-- Settings -->
        <button class="icon-btn" title="Settings">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="7" cy="7" r="2"/>
            <path d="M7 1v1.5M7 11.5V13M1 7h1.5M11.5 7H13M2.6 2.6l1.05 1.05M10.35 10.35l1.05 1.05M2.6 11.4l1.05-1.05M10.35 3.65l1.05-1.05"/>
          </svg>
        </button>

        <!-- Connection -->
        <div style="display: flex; align-items: center; gap: 5px;">
          <div class="status-dot"></div>
          <span style="font-size: 12px; color: var(--text-secondary);">Live</span>
        </div>

        <div style="width: 1px; height: 18px; background: var(--border); flex-shrink: 0;"></div>

        <!-- Activity -->
        <button class="icon-btn" title="Activity" style="gap: 4px; width: auto; padding: 0 8px; font-size: 12px; color: var(--text-secondary);">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="1,9 4,5 6.5,7 9,3 12,6"/>
          </svg>
          Activity
        </button>
      </div>

      <!-- Filter Dropdown Panel (shown open on desktop) -->
      <div class="filter-dropdown animate-filter-panel" id="desktop-filter-panel">
        <!-- Date -->
        <div class="filter-select">
          <span class="filter-select-label">Date</span>
          <span class="filter-select-value">Last 3 days</span>
          <span class="filter-select-arrow">▾</span>
        </div>

        <div class="filter-divider"></div>

        <!-- Project -->
        <div class="filter-select">
          <span class="filter-select-label">Project</span>
          <span class="filter-select-value">All projects</span>
          <span class="filter-select-arrow">▾</span>
        </div>

        <div class="filter-divider"></div>

        <!-- Agent -->
        <div class="filter-select">
          <span class="filter-select-label">Agent</span>
          <span class="filter-select-value">Any Agent</span>
          <span class="filter-select-arrow">▾</span>
        </div>

        <div class="filter-divider"></div>

        <!-- Tags -->
        <div class="filter-select">
          <span class="filter-select-label">Tags</span>
          <span class="filter-select-value">All tags</span>
          <span class="filter-select-arrow">▾</span>
        </div>

        <button class="filter-clear-btn">Clear filters</button>
      </div>

      <!-- Kanban Body Preview -->
      <div class="mockup-body animate-body">
        <div class="kanban-preview">
          <div class="kanban-col">
            <div class="kanban-col-title">Ready</div>
            <div class="kanban-card">
              <div class="kanban-card-title">Implement event replay</div>
              <div class="kanban-card-meta">agent-04 · #core</div>
            </div>
            <div class="kanban-card">
              <div class="kanban-card-title">Add tag filtering to list cmd</div>
              <div class="kanban-card-meta">unassigned · #cli</div>
            </div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-title">In Progress</div>
            <div class="kanban-card">
              <div class="kanban-card-title">WAL mode migration</div>
              <div class="kanban-card-meta">agent-02 · #db</div>
            </div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-title">Review</div>
            <div class="kanban-card">
              <div class="kanban-card-title">Projection engine refactor</div>
              <div class="kanban-card-meta">agent-01 · #core</div>
            </div>
          </div>
          <div class="kanban-col">
            <div class="kanban-col-title" style="color: var(--status-done);">Done</div>
            <div class="kanban-card" style="opacity: 0.6;">
              <div class="kanban-card-title">Atomic claim-next</div>
              <div class="kanban-card-meta">agent-03 · #core</div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ============================================================ -->
  <!-- MOBILE MOCKUP                                                -->
  <!-- ============================================================ -->
  <div style="width: 100%; max-width: 900px; display: flex; flex-direction: column; align-items: center;">
    <div class="section-label" style="width: 375px; text-align: left;">Mobile — 375px</div>

    <div class="mockup-block" style="width: 375px;">

      <!-- Mobile Header Row -->
      <div class="mobile-header">
        <!-- Logo -->
        <span class="hzl-logo" style="font-size: 13px;">HZL</span>

        <div style="width: 1px; height: 16px; background: var(--border); flex-shrink: 0;"></div>

        <!-- Compact Segmented Control (icons) -->
        <div class="segmented-control" id="mobile-seg-control" style="padding: 2px; gap: var(--segment-gap);">
          <button class="mobile-segment-btn" title="Kanban">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <rect x="1" y="1" width="4" height="12" rx="1"/>
              <rect x="6" y="1" width="4" height="8" rx="1"/>
              <rect x="11" y="1" width="2" height="10" rx="1"/>
            </svg>
          </button>
          <button class="mobile-segment-btn active" title="Calendar">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <rect x="1" y="3" width="12" height="10" rx="1"/>
              <line x1="4" y1="1" x2="4" y2="5"/>
              <line x1="10" y1="1" x2="10" y2="5"/>
              <line x1="1" y1="7" x2="13" y2="7"/>
            </svg>
          </button>
          <button class="mobile-segment-btn" title="Graph">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="3" cy="7" r="1.5"/>
              <circle cx="11" cy="3" r="1.5"/>
              <circle cx="11" cy="11" r="1.5"/>
              <line x1="4.4" y1="6.2" x2="9.6" y2="3.8"/>
              <line x1="4.4" y1="7.8" x2="9.6" y2="10.2"/>
            </svg>
          </button>
          <button class="mobile-segment-btn" title="Agents">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="7" cy="5" r="2.5"/>
              <path d="M2 12c0-2.76 2.24-5 5-5s5 2.24 5 5"/>
            </svg>
          </button>
        </div>

        <div class="spacer"></div>

        <!-- Mobile Search (icon only, no expansion) -->
        <button class="icon-btn" title="Search">
          <svg width="13" height="13" viewBox="0 0 13 13" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round">
            <circle cx="5.5" cy="5.5" r="4"/>
            <line x1="8.9" y1="8.9" x2="12" y2="12"/>
          </svg>
        </button>

        <!-- Mobile Filters Button -->
        <button class="filter-btn" style="padding: 0 8px;">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round">
            <line x1="1" y1="3" x2="11" y2="3"/>
            <line x1="3" y1="6" x2="9" y2="6"/>
            <line x1="5" y1="9" x2="7" y2="9"/>
          </svg>
          <span class="filter-label">Filters</span>
        </button>

        <!-- Connection -->
        <div class="status-dot"></div>
      </div>

      <!-- Mobile Body Preview -->
      <div class="mockup-body" style="padding: 12px; min-height: 100px;">
        <div style="display: flex; flex-direction: column; gap: 6px;">
          <div class="kanban-card" style="margin: 0;">
            <div class="kanban-card-title">Implement event replay</div>
            <div class="kanban-card-meta">Ready · agent-04 · #core</div>
          </div>
          <div class="kanban-card" style="margin: 0;">
            <div class="kanban-card-title">WAL mode migration</div>
            <div class="kanban-card-meta">In Progress · agent-02 · #db</div>
          </div>
          <div class="kanban-card" style="margin: 0;">
            <div class="kanban-card-title">Projection engine refactor</div>
            <div class="kanban-card-meta">Review · agent-01 · #core</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ============================================================
    // Segment style event control handler
    // ============================================================
    function applySegmentStyle(style) {
      const controls = document.querySelectorAll('.segmented-control');
      controls.forEach(ctrl => {
        // Remove all style classes
        ctrl.classList.remove('style-filled', 'style-outlined', 'style-pill');
        ctrl.classList.add('style-' + style.toLowerCase());
      });

      // Adjust outer radius for pill
      const isPill = style === 'Pill';
      const outerRadius = isPill ? '999px' : '6px';
      const innerRadius = isPill ? '999px' : '4px';
      document.documentElement.style.setProperty('--segment-outer-radius', outerRadius);
      document.documentElement.style.setProperty('--segment-active-radius', innerRadius);

      // Set active bg based on style
      if (style === 'Outlined') {
        document.documentElement.style.setProperty('--segment-active-bg', 'transparent');
        document.documentElement.style.setProperty('--segment-border-style', '1px solid');
      } else {
        document.documentElement.style.setProperty('--segment-active-bg', 'var(--bg-card)');
        document.documentElement.style.setProperty('--segment-border-style', 'none');
      }
    }

    // Listen for control-change events (from gallery shell)
    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;
      if (id === 'segment-style') {
        applySegmentStyle(value);
      }
    });

    // Apply initial state on controls-ready
    document.addEventListener('controls-ready', () => {
      const style = getComputedStyle(document.documentElement)
        .getPropertyValue('--segment-active-bg').trim();
      // Read initial segment style from the CSS var mapping isn't possible
      // Use default Filled state (already correct from CSS)
      applySegmentStyle('Filled');
    });

    // ============================================================
    // Interactive segment clicking within the mockup
    // ============================================================
    document.querySelectorAll('.segmented-control').forEach(ctrl => {
      ctrl.querySelectorAll('.segment-btn, .mobile-segment-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          ctrl.querySelectorAll('.segment-btn, .mobile-segment-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
    });
  </script>

</body>
</html>

  </template>
  <template id="tpl-c2" data-body-class="min-h-screen flex flex-col items-center justify-start p-8 gap-12">
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="application/json" id="variation-meta">
  {
    "id": "C2",
    "family": "C",
    "familyName": "Unified Bar",
    "name": "Pill Switcher",
    "layoutType": "Single row with pill buttons",
    "aesthetic": "HZL Dark (shared)",
    "description": "Single row: logo, view pills (active filled amber), vertical separators, inline filter chips showing current values, search input, settings, connection dot, Activity button. Everything visible at once — no hidden dropdowns.",
    "controls": [
      {
        "id": "pill-shape",
        "label": "Pill Shape",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Rounded Full", "Rounded Medium", "Sharp"],
        "cssValues": { "Rounded Full": "999px", "Rounded Medium": "6px", "Sharp": "2px" },
        "value": "Rounded Full",
        "defaultValue": "Rounded Full",
        "unit": "",
        "cssVar": "--pill-radius"
      },
      {
        "id": "pill-size",
        "label": "Pill Size",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Compact", "Default"],
        "cssValues": { "Compact": "6px 10px", "Default": "8px 14px" },
        "value": "Default",
        "defaultValue": "Default",
        "unit": "",
        "cssVar": "--pill-padding"
      },
      {
        "id": "separator-style",
        "label": "Separator Style",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Vertical Line", "Dot", "Gap Only"],
        "cssValues": { "Vertical Line": "line", "Dot": "dot", "Gap Only": "none" },
        "value": "Vertical Line",
        "defaultValue": "Vertical Line",
        "unit": "",
        "cssVar": "--separator-style",
        "event": true
      },
      {
        "id": "chip-density",
        "label": "Chip Density",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Tight", "Normal"],
        "cssValues": { "Tight": "4px", "Normal": "8px" },
        "value": "Normal",
        "defaultValue": "Normal",
        "unit": "",
        "cssVar": "--chip-gap"
      },
      {
        "id": "active-pill",
        "label": "Active Pill Style",
        "type": "select",
        "min": null, "max": null, "step": null,
        "options": ["Filled Accent", "Outline Accent"],
        "cssValues": { "Filled Accent": "filled", "Outline Accent": "outline" },
        "value": "Filled Accent",
        "defaultValue": "Filled Accent",
        "unit": "",
        "cssVar": "--active-pill-mode",
        "event": true
      }
    ]
  }
  </script>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-secondary: #252525;
      --bg-card: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a3a3a3;
      --text-muted: #737373;
      --accent: #f59e0b;
      --accent-dim: #b45309;
      --border: #404040;
      --status-done: #22c55e;

      --pill-radius: 999px;
      --pill-padding: 8px 14px;
      --chip-gap: 8px;

      /* Active pill defaults — driven by event control */
      --active-pill-bg: var(--accent);
      --active-pill-text: #1a1a1a;
      --active-pill-border: transparent;

      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
      font-size: 13px;
    }

    :root * {
      transition: color 0.3s ease, background-color 0.3s ease,
                  border-color 0.3s ease, padding 0.3s ease,
                  gap 0.3s ease, font-size 0.3s ease,
                  border-radius 0.3s ease, box-shadow 0.3s ease,
                  max-width 0.3s ease, width 0.3s ease;
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
    }

    .nav-bar {
      background-color: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
    }

    /* View pill base */
    .view-pill {
      display: inline-flex;
      align-items: center;
      padding: var(--pill-padding);
      border-radius: var(--pill-radius);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.02em;
      cursor: pointer;
      border: 1px solid transparent;
      white-space: nowrap;
      color: var(--text-secondary);
      background: transparent;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }

    .view-pill:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .view-pill.active {
      background-color: var(--active-pill-bg);
      color: var(--active-pill-text);
      border-color: var(--active-pill-border);
    }

    /* Filter chip */
    .filter-chip {
      display: inline-flex;
      align-items: center;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: var(--pill-radius);
      border: 1px solid var(--border);
      color: var(--text-muted);
      background: transparent;
      cursor: pointer;
      white-space: nowrap;
      transition: border-color 0.2s, color 0.2s, background 0.2s;
    }

    .filter-chip:hover {
      border-color: var(--text-secondary);
      color: var(--text-secondary);
      background: color-mix(in srgb, var(--text-secondary) 6%, transparent);
    }

    .filter-chips-group {
      display: flex;
      align-items: center;
      gap: var(--chip-gap);
    }

    /* Separator */
    .sep {
      display: inline-block;
      width: 1px;
      height: 20px;
      background: var(--border);
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .sep.dot-mode {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--border);
    }

    .sep.gap-only {
      background: transparent;
      width: 0;
    }

    /* Search input */
    .search-input {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--pill-radius);
      color: var(--text-primary);
      font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace;
      font-size: 12px;
      padding: 4px 10px;
      width: 150px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .search-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 15%, transparent);
    }

    .search-input::placeholder {
      color: var(--text-muted);
    }

    /* Activity button */
    .activity-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: var(--pill-padding);
      border-radius: var(--pill-radius);
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
    }

    .activity-btn:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    /* Logo */
    .logo-mark {
      font-size: 15px;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: -0.03em;
    }

    /* Mobile scroll area */
    .pills-scroll {
      display: flex;
      align-items: center;
      gap: 4px;
      overflow-x: auto;
      scrollbar-width: none;
      -webkit-overflow-scrolling: touch;
    }

    .pills-scroll::-webkit-scrollbar {
      display: none;
    }

    /* Mobile filter icon btn */
    .filter-icon-btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      border-radius: var(--pill-radius);
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      flex-shrink: 0;
      transition: background 0.2s, color 0.2s;
    }

    .filter-icon-btn:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .filter-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--accent);
      color: #1a1a1a;
      font-size: 9px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Gear icon btn */
    .icon-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }

    .icon-btn:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    /* Live dot */
    .live-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--status-done);
      flex-shrink: 0;
      animation: pulse-dot 2s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Entrance animation */
    @keyframes slide-down {
      from { opacity: 0; transform: translateY(-8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-in {
      animation: slide-down 0.4s ease forwards;
    }

    .animate-in-delay-1 { animation-delay: 0.05s; opacity: 0; }
    .animate-in-delay-2 { animation-delay: 0.1s; opacity: 0; }
    .animate-in-delay-3 { animation-delay: 0.15s; opacity: 0; }

    /* Content area below nav */
    .content-area {
      background: var(--bg-primary);
    }

    /* Kanban columns */
    .kanban-col {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 8px;
      min-height: 180px;
    }

    .kanban-col-header {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }

    .task-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px 12px;
      margin: 8px;
      cursor: pointer;
      transition: border-color 0.2s, transform 0.15s;
    }

    .task-card:hover {
      border-color: var(--text-muted);
      transform: translateY(-1px);
    }

    .task-title {
      font-size: 12px;
      color: var(--text-primary);
      font-weight: 500;
      margin-bottom: 6px;
    }

    .task-meta {
      font-size: 11px;
      color: var(--text-muted);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-8 gap-12">

  <!-- DESKTOP MOCKUP -->
  <div class="w-full animate-in" style="max-width: 1400px;">
    <div class="text-xs font-bold tracking-widest uppercase mb-3" style="color: var(--text-muted);">Desktop — 1400px</div>
    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; overflow: hidden;">

      <!-- NAV BAR -->
      <div class="nav-bar animate-in animate-in-delay-1">
        <div class="flex items-center gap-3 px-4" style="height: 48px; gap: 12px;">

          <!-- Logo -->
          <div class="flex items-center gap-2 flex-shrink-0">
            <div class="logo-mark">hzl</div>
          </div>

          <!-- Sep 1 -->
          <div class="sep" id="sep1"></div>

          <!-- View Pills -->
          <div class="flex items-center" style="gap: 4px; flex-shrink: 0;">
            <button class="view-pill active" id="pill-kanban">Kanban</button>
            <button class="view-pill" id="pill-calendar">Calendar</button>
            <button class="view-pill" id="pill-graph">Graph</button>
            <button class="view-pill" id="pill-agents">Agents</button>
          </div>

          <!-- Sep 2 -->
          <div class="sep" id="sep2"></div>

          <!-- Filter Chips -->
          <div class="filter-chips-group animate-in animate-in-delay-2" id="filter-chips">
            <button class="filter-chip">
              <svg width="10" height="10" viewBox="0 0 12 12" fill="none" style="margin-right:4px;opacity:0.6;">
                <rect x="1" y="2" width="10" height="9" rx="1.5" stroke="currentColor" stroke-width="1.3"/>
                <path d="M4 1v2M8 1v2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
                <path d="M1 5h10" stroke="currentColor" stroke-width="1.3"/>
              </svg>
              3d
            </button>
            <button class="filter-chip">
              <svg width="10" height="10" viewBox="0 0 12 12" fill="none" style="margin-right:4px;opacity:0.6;">
                <circle cx="6" cy="6" r="4.5" stroke="currentColor" stroke-width="1.3"/>
                <circle cx="6" cy="6" r="2" stroke="currentColor" stroke-width="1.3"/>
              </svg>
              All proj
            </button>
            <button class="filter-chip">
              <svg width="10" height="10" viewBox="0 0 12 12" fill="none" style="margin-right:4px;opacity:0.6;">
                <circle cx="6" cy="4" r="2.5" stroke="currentColor" stroke-width="1.3"/>
                <path d="M1.5 10.5c0-2.485 2.015-4.5 4.5-4.5s4.5 2.015 4.5 4.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
              Any Agent
            </button>
            <button class="filter-chip">
              <svg width="10" height="10" viewBox="0 0 12 12" fill="none" style="margin-right:4px;opacity:0.6;">
                <path d="M2 3h8M3 6h6M4 9h4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
              </svg>
              All tags
            </button>
          </div>

          <!-- Sep 3 -->
          <div class="sep" id="sep3"></div>

          <!-- Search -->
          <input class="search-input" type="text" placeholder="/ Find" />

          <!-- Flex spacer -->
          <div class="flex-1"></div>

          <!-- Settings gear -->
          <button class="icon-btn" title="Settings">
            <svg width="15" height="15" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="2.5" stroke="currentColor" stroke-width="1.3"/>
              <path d="M8 1.5v1M8 13.5v1M1.5 8h1M13.5 8h1M3.4 3.4l.7.7M11.9 11.9l.7.7M3.4 12.6l.7-.7M11.9 4.1l.7-.7" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            </svg>
          </button>

          <!-- Connection status -->
          <div class="flex items-center gap-1.5 flex-shrink-0" style="color: var(--text-muted); font-size: 11px;">
            <div class="live-dot"></div>
            <span>Live</span>
          </div>

          <!-- Sep 4 -->
          <div class="sep" id="sep4"></div>

          <!-- Activity button -->
          <button class="activity-btn">
            <svg width="12" height="12" viewBox="0 0 14 14" fill="none">
              <path d="M1 7h2l2-4 2 8 2-6 1.5 2H13" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Activity
          </button>

        </div>
      </div>

      <!-- CONTENT AREA — Kanban board mock -->
      <div class="content-area p-5 animate-in animate-in-delay-3">
        <div class="grid grid-cols-4 gap-4">

          <!-- Ready -->
          <div class="kanban-col">
            <div class="kanban-col-header flex items-center gap-2">
              <div class="status-dot" style="background: var(--text-muted);"></div>
              Ready
              <span class="ml-auto" style="color: var(--text-muted); font-weight: 400;">3</span>
            </div>
            <div class="task-card">
              <div class="task-title">Implement auth flow</div>
              <div class="task-meta">hzl-web · #T-041</div>
            </div>
            <div class="task-card">
              <div class="task-title">Add search indexing</div>
              <div class="task-meta">hzl-core · #T-038</div>
            </div>
            <div class="task-card">
              <div class="task-title">Write migration scripts</div>
              <div class="task-meta">hzl-cli · #T-035</div>
            </div>
          </div>

          <!-- In Progress -->
          <div class="kanban-col">
            <div class="kanban-col-header flex items-center gap-2">
              <div class="status-dot" style="background: var(--accent);"></div>
              In Progress
              <span class="ml-auto" style="color: var(--text-muted); font-weight: 400;">2</span>
            </div>
            <div class="task-card" style="border-color: color-mix(in srgb, var(--accent) 30%, var(--border));">
              <div class="task-title">Event sourcing refactor</div>
              <div class="task-meta flex items-center gap-2">hzl-core · #T-029
                <span style="color: var(--accent);">65%</span>
              </div>
            </div>
            <div class="task-card">
              <div class="task-title">Dashboard nav redesign</div>
              <div class="task-meta flex items-center gap-2">hzl-web · #T-044
                <span style="color: var(--accent);">20%</span>
              </div>
            </div>
          </div>

          <!-- Review -->
          <div class="kanban-col">
            <div class="kanban-col-header flex items-center gap-2">
              <div class="status-dot" style="background: #818cf8;"></div>
              Review
              <span class="ml-auto" style="color: var(--text-muted); font-weight: 400;">1</span>
            </div>
            <div class="task-card">
              <div class="task-title">CLI claim-next logic</div>
              <div class="task-meta">hzl-cli · #T-031</div>
            </div>
          </div>

          <!-- Done -->
          <div class="kanban-col">
            <div class="kanban-col-header flex items-center gap-2">
              <div class="status-dot" style="background: var(--status-done);"></div>
              Done
              <span class="ml-auto" style="color: var(--text-muted); font-weight: 400;">4</span>
            </div>
            <div class="task-card" style="opacity: 0.65;">
              <div class="task-title">WAL mode configuration</div>
              <div class="task-meta">hzl-core · #T-022</div>
            </div>
            <div class="task-card" style="opacity: 0.65;">
              <div class="task-title">XDG path resolution</div>
              <div class="task-meta">hzl-cli · #T-019</div>
            </div>
          </div>

        </div>
      </div>

    </div>
  </div>

  <!-- MOBILE MOCKUP -->
  <div class="animate-in animate-in-delay-2" style="width: 375px;">
    <div class="text-xs font-bold tracking-widest uppercase mb-3" style="color: var(--text-muted);">Mobile — 375px</div>
    <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; width: 375px;">

      <!-- Mobile Nav -->
      <div class="nav-bar">
        <div class="flex items-center gap-2 px-3" style="height: 48px;">

          <!-- Logo -->
          <div class="logo-mark flex-shrink-0">hzl</div>

          <!-- Mobile Sep -->
          <div class="sep flex-shrink-0" id="mob-sep1"></div>

          <!-- Pills — horizontal scroll -->
          <div class="pills-scroll flex-1" style="min-width: 0;">
            <button class="view-pill active" id="mob-pill-kanban">Kanban</button>
            <button class="view-pill" id="mob-pill-calendar">Calendar</button>
            <button class="view-pill" id="mob-pill-graph">Graph</button>
            <button class="view-pill" id="mob-pill-agents">Agents</button>
          </div>

          <!-- Mobile Sep -->
          <div class="sep flex-shrink-0" id="mob-sep2"></div>

          <!-- Filter icon with badge -->
          <button class="filter-icon-btn flex-shrink-0" title="Filters">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <path d="M2 4h12M4 8h8M6 12h4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
            </svg>
            <div class="filter-badge">4</div>
          </button>

          <!-- Gear -->
          <button class="icon-btn flex-shrink-0" title="Settings">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="2.5" stroke="currentColor" stroke-width="1.3"/>
              <path d="M8 1.5v1M8 13.5v1M1.5 8h1M13.5 8h1M3.4 3.4l.7.7M11.9 11.9l.7.7M3.4 12.6l.7-.7M11.9 4.1l.7-.7" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/>
            </svg>
          </button>

          <!-- Live dot -->
          <div class="live-dot flex-shrink-0"></div>

        </div>
      </div>

      <!-- Mobile Kanban — single column scroll hint -->
      <div class="content-area p-3">
        <div style="font-size: 10px; color: var(--text-muted); margin-bottom: 8px; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700;">In Progress · 2</div>
        <div class="task-card" style="border-color: color-mix(in srgb, var(--accent) 30%, var(--border)); margin: 0 0 8px 0;">
          <div class="task-title">Event sourcing refactor</div>
          <div class="task-meta flex items-center gap-2">hzl-core · #T-029
            <span style="color: var(--accent);">65%</span>
          </div>
        </div>
        <div class="task-card" style="margin: 0;">
          <div class="task-title">Dashboard nav redesign</div>
          <div class="task-meta">hzl-web · #T-044</div>
        </div>
        <div style="font-size: 10px; color: var(--text-muted); margin-top: 12px; margin-bottom: 8px; letter-spacing: 0.05em; text-transform: uppercase; font-weight: 700;">Ready · 3</div>
        <div class="task-card" style="margin: 0 0 8px 0;">
          <div class="task-title">Implement auth flow</div>
          <div class="task-meta">hzl-web · #T-041</div>
        </div>
        <div class="task-card" style="margin: 0;">
          <div class="task-title">Add search indexing</div>
          <div class="task-meta">hzl-core · #T-038</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // Active pill state management
    const activeClass = 'active';

    // View pills click on desktop
    const desktopPills = document.querySelectorAll('.view-pill:not([id^="mob-"])');
    desktopPills.forEach(pill => {
      pill.addEventListener('click', () => {
        desktopPills.forEach(p => p.classList.remove(activeClass));
        pill.classList.add(activeClass);
        applyActivePillStyle(currentActivePillMode);
      });
    });

    // View pills click on mobile
    const mobilePills = document.querySelectorAll('[id^="mob-pill-"]');
    mobilePills.forEach(pill => {
      pill.addEventListener('click', () => {
        mobilePills.forEach(p => p.classList.remove(activeClass));
        pill.classList.add(activeClass);
        applyActivePillStyle(currentActivePillMode);
      });
    });

    let currentActivePillMode = 'filled';
    let currentSeparatorStyle = 'line';

    function applyActivePillStyle(mode) {
      const activePills = document.querySelectorAll('.view-pill.active');
      if (mode === 'filled') {
        activePills.forEach(p => {
          p.style.backgroundColor = 'var(--accent)';
          p.style.color = '#1a1a1a';
          p.style.borderColor = 'transparent';
        });
      } else {
        // outline
        activePills.forEach(p => {
          p.style.backgroundColor = 'transparent';
          p.style.color = 'var(--accent)';
          p.style.borderColor = 'var(--accent)';
        });
      }
    }

    function applySeparatorStyle(style) {
      const seps = document.querySelectorAll('.sep');
      seps.forEach(sep => {
        sep.classList.remove('dot-mode', 'gap-only');
        if (style === 'dot') {
          sep.classList.add('dot-mode');
        } else if (style === 'none' || style === 'Gap Only') {
          sep.classList.add('gap-only');
        }
      });
    }

    // Control event listener
    document.addEventListener('control-change', (e) => {
      const { id, value } = e.detail;
      if (id === 'active-pill') {
        // value is "filled" or "outline" (cssValues mapping)
        currentActivePillMode = value;
        applyActivePillStyle(value);
      }
      if (id === 'separator-style') {
        currentSeparatorStyle = value;
        applySeparatorStyle(value);
      }
    });

    // Initial state on controls-ready
    document.addEventListener('controls-ready', () => {
      const modeRaw = getComputedStyle(document.documentElement)
        .getPropertyValue('--active-pill-mode').trim();
      if (modeRaw) {
        currentActivePillMode = modeRaw;
        applyActivePillStyle(modeRaw);
      }

      const sepRaw = getComputedStyle(document.documentElement)
        .getPropertyValue('--separator-style').trim();
      if (sepRaw) {
        currentSeparatorStyle = sepRaw;
        applySeparatorStyle(sepRaw);
      }
    });

    // Apply initial defaults immediately (for standalone rendering)
    applyActivePillStyle('filled');
    applySeparatorStyle('line');
  </script>

</body>
</html>

  </template>

  <!-- ==================== ALPINE.JS DATA MODEL ==================== -->
  <script>
    function explorer() {
      return {
        // --- State ---
        variations: [{
  id: 'A1',
  family: 'A',
  familyName: 'Stacked Layers',
  name: 'Toolbar Stack',
  layoutType: 'Two-row horizontal',
  aesthetic: 'HZL Dark (shared)',
  description: 'Two distinct rows — top row has logo, filled tab buttons for views, connection status, and activity toggle. Bottom row has all contextual filters as full dropdowns. Bottom row hides entirely on views that don\'t need filters (like Agents).',
  controls: [
    {
        "id": "tab-style",
        "label": "Tab Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Filled",
            "Bordered",
            "Ghost"
        ],
        "cssValues": {
            "Filled": "var(--accent)",
            "Bordered": "transparent",
            "Ghost": "transparent"
        },
        "value": "Filled",
        "defaultValue": "Filled",
        "unit": "",
        "cssVar": "--tab-active-bg",
        "event": true
    },
    {
        "id": "row-gap",
        "label": "Row Gap",
        "type": "range",
        "min": 0,
        "max": 8,
        "step": 1,
        "options": null,
        "value": 0,
        "defaultValue": 0,
        "unit": "px",
        "cssVar": "--row-gap"
    },
    {
        "id": "filter-height",
        "label": "Filter Row Height",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Compact",
            "Comfortable"
        ],
        "cssValues": {
            "Compact": "36px",
            "Comfortable": "48px"
        },
        "value": "Compact",
        "defaultValue": "Compact",
        "unit": "",
        "cssVar": "--filter-row-height"
    },
    {
        "id": "tab-gap",
        "label": "Tab Spacing",
        "type": "range",
        "min": 0,
        "max": 8,
        "step": 2,
        "options": null,
        "value": 4,
        "defaultValue": 4,
        "unit": "px",
        "cssVar": "--tab-gap"
    },
    {
        "id": "active-indicator",
        "label": "Active Indicator",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Background Fill",
            "Bottom Border",
            "Dot Badge"
        ],
        "cssValues": {
            "Background Fill": "none",
            "Bottom Border": "2px solid var(--accent)",
            "Dot Badge": "none"
        },
        "value": "Background Fill",
        "defaultValue": "Background Fill",
        "unit": "",
        "cssVar": "--tab-indicator-border",
        "event": true
    }
]
},
{
  id: 'A2',
  family: 'A',
  familyName: 'Stacked Layers',
  name: 'Underline Tabs',
  layoutType: 'Two-row with underline nav',
  aesthetic: 'HZL Dark (shared)',
  description: 'Two rows: top with underline-style text tabs, bottom with compact pill-shaped filter chips. Lighter, editorial feel.',
  controls: [
    {
        "id": "underline-thickness",
        "label": "Underline Thickness",
        "type": "range",
        "min": 1,
        "max": 4,
        "step": 1,
        "options": null,
        "value": 2,
        "defaultValue": 2,
        "unit": "px",
        "cssVar": "--underline-thickness"
    },
    {
        "id": "tab-case",
        "label": "Uppercase Tabs",
        "type": "toggle",
        "min": null,
        "max": null,
        "step": null,
        "options": null,
        "cssValues": {
            "true": "uppercase",
            "false": "none"
        },
        "value": false,
        "defaultValue": false,
        "unit": "",
        "cssVar": "--tab-text-transform"
    },
    {
        "id": "chip-style",
        "label": "Chip Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Outlined",
            "Filled",
            "Ghost"
        ],
        "cssValues": {
            "Outlined": "transparent",
            "Filled": "var(--bg-card)",
            "Ghost": "transparent"
        },
        "value": "Outlined",
        "defaultValue": "Outlined",
        "unit": "",
        "cssVar": "--chip-bg",
        "event": true
    },
    {
        "id": "row-separator",
        "label": "Row Separator",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Line",
            "Shadow",
            "Gap"
        ],
        "cssValues": {
            "Line": "1px solid var(--border)",
            "Shadow": "none",
            "Gap": "none"
        },
        "value": "Line",
        "defaultValue": "Line",
        "unit": "",
        "cssVar": "--row-separator"
    },
    {
        "id": "tab-spacing",
        "label": "Tab Spacing",
        "type": "range",
        "min": 16,
        "max": 40,
        "step": 4,
        "options": null,
        "value": 24,
        "defaultValue": 24,
        "unit": "px",
        "cssVar": "--tab-spacing"
    }
]
},
{
  id: 'B1',
  family: 'B',
  familyName: 'Compact Rail',
  name: 'Icon Rail',
  layoutType: 'Vertical icon sidebar + top bar',
  aesthetic: 'HZL Dark (shared)',
  description: 'A narrow 48px left rail with HZL logo at top, then 4 view icons stacked vertically. Active view has a left accent bar. Top bar spans full width for filters, search, connection status, and activity.',
  controls: [
    {
        "id": "rail-width",
        "label": "Rail Width",
        "type": "range",
        "min": 40,
        "max": 64,
        "step": 4,
        "options": null,
        "value": 48,
        "defaultValue": 48,
        "unit": "px",
        "cssVar": "--rail-width"
    },
    {
        "id": "active-indicator",
        "label": "Active Indicator",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Left Bar",
            "Background Fill",
            "Icon Glow"
        ],
        "cssValues": {
            "Left Bar": "3px",
            "Background Fill": "0px",
            "Icon Glow": "0px"
        },
        "value": "Left Bar",
        "defaultValue": "Left Bar",
        "unit": "",
        "cssVar": "--indicator-bar-width",
        "event": true
    },
    {
        "id": "icon-size",
        "label": "Icon Size",
        "type": "range",
        "min": 16,
        "max": 24,
        "step": 2,
        "options": null,
        "value": 20,
        "defaultValue": 20,
        "unit": "px",
        "cssVar": "--icon-size"
    },
    {
        "id": "bar-density",
        "label": "Filter Bar Density",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Compact",
            "Comfortable"
        ],
        "cssValues": {
            "Compact": "40px",
            "Comfortable": "52px"
        },
        "value": "Compact",
        "defaultValue": "Compact",
        "unit": "",
        "cssVar": "--filter-bar-height"
    },
    {
        "id": "rail-position",
        "label": "Rail Position",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Left",
            "Right"
        ],
        "cssValues": {
            "Left": "row",
            "Right": "row-reverse"
        },
        "value": "Left",
        "defaultValue": "Left",
        "unit": "",
        "cssVar": "--layout-direction"
    }
]
},
{
  id: 'B2',
  family: 'B',
  familyName: 'Compact Rail',
  name: 'Label Rail',
  layoutType: 'Vertical labeled sidebar + top bar',
  aesthetic: 'HZL Dark (shared)',
  description: 'A wider 120px left rail with the HZL logo at the top, then text-labeled view links stacked vertically. Active view has a filled background pill. Top bar holds contextual filters + search + connection + activity.',
  controls: [
    {
        "id": "rail-width",
        "label": "Rail Width",
        "type": "range",
        "min": 100,
        "max": 160,
        "step": 10,
        "options": null,
        "value": 120,
        "defaultValue": 120,
        "unit": "px",
        "cssVar": "--rail-width"
    },
    {
        "id": "label-size",
        "label": "Label Size",
        "type": "range",
        "min": 11,
        "max": 14,
        "step": 1,
        "options": null,
        "value": 12,
        "defaultValue": 12,
        "unit": "px",
        "cssVar": "--label-size"
    },
    {
        "id": "active-style",
        "label": "Active Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Filled Background",
            "Left Accent Bar",
            "Underline"
        ],
        "cssValues": {
            "Filled Background": "filled",
            "Left Accent Bar": "accent-bar",
            "Underline": "underline"
        },
        "value": "Filled Background",
        "defaultValue": "Filled Background",
        "unit": "",
        "cssVar": "--active-style",
        "event": true
    },
    {
        "id": "rail-divider",
        "label": "Rail Divider",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Line",
            "Shadow",
            "None"
        ],
        "cssValues": {
            "Line": "1px solid #404040",
            "Shadow": "2px 0 8px rgba(0,0,0,0.4)",
            "None": "none"
        },
        "value": "Line",
        "defaultValue": "Line",
        "unit": "",
        "cssVar": "--rail-divider"
    },
    {
        "id": "show-icons",
        "label": "Show Icons",
        "type": "toggle",
        "min": null,
        "max": null,
        "step": null,
        "options": null,
        "cssValues": {
            "true": "inline-flex",
            "false": "none"
        },
        "value": true,
        "defaultValue": true,
        "unit": "",
        "cssVar": "--icon-display"
    }
]
},
{
  id: 'C1',
  family: 'C',
  familyName: 'Unified Bar',
  name: 'Segmented Control',
  layoutType: 'Single row with segmented switcher',
  aesthetic: 'HZL Dark (shared)',
  description: 'Everything in one header row — prominent segmented control for view switching, progressive disclosure for filters via dropdown panel, inline search.',
  controls: [
    {
        "id": "segment-style",
        "label": "Segment Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Filled",
            "Outlined",
            "Pill"
        ],
        "cssValues": {
            "Filled": "var(--bg-card)",
            "Outlined": "transparent",
            "Pill": "var(--bg-card)"
        },
        "value": "Filled",
        "defaultValue": "Filled",
        "unit": "",
        "cssVar": "--segment-active-bg",
        "event": true
    },
    {
        "id": "control-size",
        "label": "Control Size",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Compact",
            "Default",
            "Large"
        ],
        "cssValues": {
            "Compact": "28px",
            "Default": "34px",
            "Large": "40px"
        },
        "value": "Default",
        "defaultValue": "Default",
        "unit": "",
        "cssVar": "--segment-height"
    },
    {
        "id": "filter-btn-style",
        "label": "Show Filter Label",
        "type": "toggle",
        "min": null,
        "max": null,
        "step": null,
        "options": null,
        "cssValues": {
            "true": "inline",
            "false": "none"
        },
        "value": true,
        "defaultValue": true,
        "unit": "",
        "cssVar": "--filter-label-display"
    },
    {
        "id": "segment-gap",
        "label": "Segment Gap",
        "type": "range",
        "min": 0,
        "max": 4,
        "step": 1,
        "options": null,
        "value": 0,
        "defaultValue": 0,
        "unit": "px",
        "cssVar": "--segment-gap"
    },
    {
        "id": "search-width",
        "label": "Search Width",
        "type": "range",
        "min": 120,
        "max": 220,
        "step": 20,
        "options": null,
        "value": 160,
        "defaultValue": 160,
        "unit": "px",
        "cssVar": "--search-width"
    }
]
},
{
  id: 'C2',
  family: 'C',
  familyName: 'Unified Bar',
  name: 'Pill Switcher',
  layoutType: 'Single row with pill buttons',
  aesthetic: 'HZL Dark (shared)',
  description: 'Single row: logo, view pills (active filled amber), vertical separators, inline filter chips showing current values, search input, settings, connection dot, Activity button. Everything visible at once — no hidden dropdowns.',
  controls: [
    {
        "id": "pill-shape",
        "label": "Pill Shape",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Rounded Full",
            "Rounded Medium",
            "Sharp"
        ],
        "cssValues": {
            "Rounded Full": "999px",
            "Rounded Medium": "6px",
            "Sharp": "2px"
        },
        "value": "Rounded Full",
        "defaultValue": "Rounded Full",
        "unit": "",
        "cssVar": "--pill-radius"
    },
    {
        "id": "pill-size",
        "label": "Pill Size",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Compact",
            "Default"
        ],
        "cssValues": {
            "Compact": "6px 10px",
            "Default": "8px 14px"
        },
        "value": "Default",
        "defaultValue": "Default",
        "unit": "",
        "cssVar": "--pill-padding"
    },
    {
        "id": "separator-style",
        "label": "Separator Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Vertical Line",
            "Dot",
            "Gap Only"
        ],
        "cssValues": {
            "Vertical Line": "line",
            "Dot": "dot",
            "Gap Only": "none"
        },
        "value": "Vertical Line",
        "defaultValue": "Vertical Line",
        "unit": "",
        "cssVar": "--separator-style",
        "event": true
    },
    {
        "id": "chip-density",
        "label": "Chip Density",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Tight",
            "Normal"
        ],
        "cssValues": {
            "Tight": "4px",
            "Normal": "8px"
        },
        "value": "Normal",
        "defaultValue": "Normal",
        "unit": "",
        "cssVar": "--chip-gap"
    },
    {
        "id": "active-pill",
        "label": "Active Pill Style",
        "type": "select",
        "min": null,
        "max": null,
        "step": null,
        "options": [
            "Filled Accent",
            "Outline Accent"
        ],
        "cssValues": {
            "Filled Accent": "filled",
            "Outline Accent": "outline"
        },
        "value": "Filled Accent",
        "defaultValue": "Filled Accent",
        "unit": "",
        "cssVar": "--active-pill-mode",
        "event": true
    }
]
}],
        currentIndex: 0,
        meta: {},
        showControls: false,
        showExport: false,
        showFinalize: false,
        showShortcuts: false,
        isTransitioning: true,
        copiedFeedback: false,
        copiedDirection: false,
        finalizeNotes: '',
        directionText: '',
        ratings: {},

        // --- Computed ---
        get current() { return this.variations[this.currentIndex]; },
        get families() {
          const map = {};
          this.variations.forEach(v => {
            if (!map[v.family]) map[v.family] = { letter: v.family, name: v.familyName, variations: [] };
            map[v.family].variations.push(v);
          });
          return Object.values(map);
        },
        get currentRating() { return this.ratings[this.current.id] || { stars: null, notes: '' }; },
        get reviewedCount() { return Object.values(this.ratings).filter(r => r.stars != null).length; },

        // --- Init ---
        init() {
          this.meta = JSON.parse(document.getElementById('exploration-metadata').textContent);
          this.variations.forEach(v => { v.controls.forEach((c, i) => this.normalizeControl(c, i)); });
          this.loadState();
          this.directionText = this.defaultDirection();
          this.$nextTick(() => this.loadVariationInIframe());
        },
        // Fix common subagent deviations from the control schema
        normalizeControl(c, index) {
          // Auto-generate id if missing — most common subagent mistake
          if (!c.id && c.label) c.id = c.label.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/-$/, '');
          if (!c.id) c.id = 'ctrl-' + index;
          // Normalize type — map alternates and infer from data shape
          const typeMap = { boolean: 'toggle', switch: 'toggle', checkbox: 'toggle', slider: 'range', dropdown: 'select', radio: 'select' };
          if (c.type) c.type = typeMap[c.type.toLowerCase()] || c.type.toLowerCase();
          if (!c.type || !['range', 'select', 'toggle'].includes(c.type)) {
            if (c.min != null || c.max != null) c.type = 'range';
            else if (Array.isArray(c.options) && c.options.length) c.type = 'select';
            else if (typeof c.value === 'boolean' || typeof c.default === 'boolean') c.type = 'toggle';
            else c.type = 'toggle'; // safe fallback
          }
          // cssValues as array → convert to object keyed by option labels
          if (Array.isArray(c.cssValues) && Array.isArray(c.options) && c.cssValues.length === c.options.length) {
            const obj = {};
            c.options.forEach((opt, i) => { obj[typeof opt === 'string' ? opt : (opt.label || String(opt))] = c.cssValues[i]; });
            c.cssValues = obj;
          }
          // Select with cssValues but no options → derive options from cssValues keys
          if (c.cssValues && typeof c.cssValues === 'object' && !Array.isArray(c.cssValues) &&
              (!Array.isArray(c.options) || c.options.length === 0)) {
            c.options = Object.keys(c.cssValues);
            if (!c.type) c.type = 'select';
          }
          // options as objects [{label,value}] → extract labels + build cssValues + valueToLabel map
          let valueToLabel = {};
          if (Array.isArray(c.options) && c.options.length && typeof c.options[0] === 'object') {
            if (!c.cssValues) c.cssValues = {};
            const labels = [];
            c.options.forEach(o => {
              const lbl = o.label || o.name || String(o.value);
              const val = o.value != null ? o.value : o.cssValue || lbl;
              labels.push(lbl);
              valueToLabel[val] = lbl;
              // Per-option cssValues object (multi-var) takes priority over scalar value
              if (!(lbl in c.cssValues)) {
                if (o.cssValues && typeof o.cssValues === 'object') {
                  c.cssValues[lbl] = o.cssValues;
                } else {
                  c.cssValues[lbl] = String(val);
                }
              }
            });
            c.options = labels;
          }
          // "default" → value/defaultValue (resolve via valueToLabel if needed)
          const resolve = v => valueToLabel[v] || v;
          if (c.value == null && c.default != null) c.value = resolve(c.default);
          if (c.value != null) c.value = resolve(c.value);
          if (c.defaultValue == null && c.default != null) c.defaultValue = resolve(c.default);
          if (c.defaultValue == null && c.value != null) c.defaultValue = c.value;
          if (c.value == null && c.defaultValue != null) c.value = c.defaultValue;
          // Range with string value containing unit (e.g. '0.5s') → parse to number
          if (c.type === 'range' && typeof c.value === 'string') {
            const parsed = parseFloat(c.value);
            if (!isNaN(parsed)) { c.value = parsed; c.defaultValue = parsed; }
          }
          // Range with unit '%' — keep unit for display label but strip for CSS
          // generation when it's a 0-100 scale. CSS vars should receive the raw
          // number (e.g., 50 not 50%) so calc() like 'calc(var(--x) / 100)' or
          // 'calc(var(--x) * 1%)' works correctly. Store display unit separately.
          if (c.type === 'range' && c.unit === '%') {
            c._displayUnit = '%';
            c.unit = '';
          }
          // Ensure value is in options for select
          if (c.type === 'select' && Array.isArray(c.options) && c.options.length && !c.options.includes(c.value)) {
            c.value = c.options[0];
            c.defaultValue = c.options[0];
          }
        },

        // --- Iframe ---
        loadVariationInIframe() {
          const tpl = document.getElementById('tpl-' + this.current.id.toLowerCase());
          if (!tpl) return;
          this.$refs.iframe.srcdoc = '<!DOCTYPE html>\n' + tpl.innerHTML;
        },
        onIframeLoad() {
          if (!this.$refs.iframe?.srcdoc) return;
          // Restore body class — <template> parser strips <body> attributes,
          // so assemble.py preserves them as data-body-class on the template element
          const tpl = document.getElementById('tpl-' + this.current.id.toLowerCase());
          if (tpl) {
            const bodyClass = tpl.getAttribute('data-body-class');
            if (bodyClass && this.$refs.iframe.contentDocument?.body) {
              this.$refs.iframe.contentDocument.body.className = bodyClass;
            }
          }
          this.applyControlsToIframe();
          this.isTransitioning = false;
        },
        applyControlsToIframe() {
          const doc = this.$refs.iframe?.contentDocument;
          if (!doc) return;
          this.current.controls.forEach(c => {
            if (c.value == null) return;
            const val = c.value;
            if (c.cssValues) {
              const mapped = c.cssValues[val] ?? c.cssValues[String(val)];
              if (mapped && typeof mapped === 'object') {
                Object.entries(mapped).forEach(([prop, v]) => doc.documentElement.style.setProperty(prop, v));
              } else if (mapped != null && c.cssVar) {
                doc.documentElement.style.setProperty(c.cssVar, mapped);
              }
            } else if (c.cssVar) {
              if (c.type === 'toggle') {
                doc.documentElement.style.setProperty(c.cssVar, val ? '1' : '0');
              } else {
                doc.documentElement.style.setProperty(c.cssVar, String(val) + (c.unit || ''));
              }
            }
            // Dispatch event for behavioral controls (and any variation listening)
            try { doc.dispatchEvent(new CustomEvent('control-change', { detail: { id: c.id, value: val } })); } catch(e) {}
          });
          // Signal that all controls have been applied (useful for initial load)
          try { doc.dispatchEvent(new CustomEvent('controls-ready')); } catch(e) {}
        },

        // --- Navigation ---
        goTo(index) {
          if (index === this.currentIndex) return;
          this.isTransitioning = true;
          setTimeout(() => {
            this.currentIndex = index;
            this.loadVariationInIframe();
          }, 150);
        },
        next() { this.goTo((this.currentIndex + 1) % this.variations.length); },
        prev() { this.goTo((this.currentIndex - 1 + this.variations.length) % this.variations.length); },
        selectVariation(id) {
          const idx = this.variations.findIndex(v => v.id === id);
          if (idx !== -1) this.goTo(idx);
        },

        // --- Controls ---
        updateControl(controlId, value) {
          const control = this.current.controls.find(c => c.id === controlId);
          if (control) { control.value = value; this.saveControlState(); this.applyControlsToIframe(); }
        },
        resetControls() {
          this.current.controls.forEach(c => { c.value = c.defaultValue; });
          this.saveControlState();
          this.applyControlsToIframe();
        },
        replayVariation() {
          this.isTransitioning = true;
          setTimeout(() => this.loadVariationInIframe(), 150);
        },

        // --- Rating ---
        rate(stars) {
          if (!this.ratings[this.current.id]) this.ratings[this.current.id] = { stars: null, notes: '' };
          // Clicking same rating clears it (back to unreviewed); otherwise set the new rating
          this.ratings[this.current.id].stars = this.ratings[this.current.id].stars === stars ? null : stars;
          this.saveState();
        },
        updateNotes(text) {
          if (!this.ratings[this.current.id]) this.ratings[this.current.id] = { stars: null, notes: '' };
          this.ratings[this.current.id].notes = text;
          this.saveState();
        },

        // --- Export ---
        generateFeedback() {
          const m = this.meta;
          const title = m.topic ? m.topic.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase()) : m.project;
          let out = `## Design Exploration Feedback \u2014 ${title} (Round ${m.round})\n`;
          out += `Source: ${m.sourceDirectory}/v${m.round}.html (read exploration-metadata JSON from this file for full context)\n`;
          out += `Reviewed: ${this.reviewedCount}/${this.variations.length} variations\n`;
          const loved = this.variations.filter(v => (this.ratings[v.id]?.stars ?? -1) >= 4);
          const mixed = this.variations.filter(v => { const s = this.ratings[v.id]?.stars; return s != null && s >= 2 && s <= 3; });
          const low = this.variations.filter(v => this.ratings[v.id]?.stars === 1);
          const skipped = this.variations.filter(v => this.ratings[v.id]?.stars === 0);
          const unreviewed = this.variations.filter(v => this.ratings[v.id]?.stars == null);
          const fmtAdjusted = (v) => {
            const adjusted = v.controls.filter(c => {
              if (c.defaultValue == null) return false;
              return JSON.stringify(c.value) !== JSON.stringify(c.defaultValue);
            });
            if (!adjusted.length) return '';
            const parts = adjusted.map(c => {
              const d = c.defaultValue;
              const u = c.unit || '';
              if (c.type === 'toggle') return `${c.label}: ${d ? 'on' : 'off'} \u2192 ${c.value ? 'on' : 'off'}`;
              if (c.type === 'range') return `${c.label}: ${d}${u} \u2192 ${c.value}${u}`;
              return `${c.label}: ${d} \u2192 ${c.value}`;
            });
            return `  Adjusted: ${parts.join(', ')}\n`;
          };
          const famApproach = (v) => {
            const fam = m.families?.find(f => f.letter === v.family);
            return fam?.approach ? `  Approach: ${fam.approach}\n` : '';
          };
          const fmt = (v) => {
            const rt = this.ratings[v.id];
            let line = `- **${v.id} \u201C${v.name}\u201D** (${rt.stars}\u2605) \u2014 Family ${v.family} \u201C${v.familyName}\u201D\n`;
            line += famApproach(v);
            line += `  ${v.layoutType} / ${v.aesthetic}: ${v.description}\n`;
            if (rt.notes) line += `  Note: ${rt.notes}\n`;
            line += fmtAdjusted(v);
            return line;
          };
          if (loved.length) { out += `\n**Loved (4-5\u2605)**\n`; loved.forEach(v => out += fmt(v)); }
          if (mixed.length) { out += `\n**Mixed (2-3\u2605)**\n`; mixed.forEach(v => out += fmt(v)); }
          if (low.length) { out += `\n**Low (1\u2605)**\n`; low.forEach(v => out += fmt(v)); }
          if (skipped.length) {
            out += `\n**Skip (0\u2605)**\n`;
            skipped.forEach(v => {
              let line = `- **${v.id} \u201C${v.name}\u201D** \u2014 Family ${v.family} \u201C${v.familyName}\u201D\n`;
              line += famApproach(v);
              line += `  ${v.layoutType} / ${v.aesthetic}: ${v.description}\n`;
              const rt = this.ratings[v.id];
              if (rt?.notes) line += `  Note: ${rt.notes}\n`;
              line += fmtAdjusted(v);
              out += line;
            });
          }
          if (unreviewed.length) {
            out += `\n**Not reviewed**\n`;
            unreviewed.forEach(v => {
              let line = `- ${v.id} \u201C${v.name}\u201D \u2014 Family ${v.family} \u201C${v.familyName}\u201D\n`;
              line += famApproach(v);
              line += `  ${v.layoutType} / ${v.aesthetic}: ${v.description}\n`;
              out += line;
            });
          }
          return out;
        },
        defaultDirection() {
          const loved = this.variations.filter(v => (this.ratings[v.id]?.stars ?? -1) >= 4);
          const skipped = this.variations.filter(v => this.ratings[v.id]?.stars === 0);
          let d = '';
          if (loved.length) d += `Keep: ${loved.map(v => v.id + ' "' + v.name + '"').join(', ')}. `;
          if (skipped.length) d += `Drop: ${skipped.map(v => v.id + ' "' + v.name + '"').join(', ')}. `;
          return d;
        },
        copyFeedback() {
          const feedback = this.generateFeedback();
          const direction = this.directionText.trim() || '[No direction provided]';
          const full = feedback + '\n### Direction for Next Round\n' + direction;
          navigator.clipboard.writeText(full);
          this.copiedFeedback = true;
          setTimeout(() => { this.copiedFeedback = false; }, 2000);
        },

        // --- Finalize ---
        openFinalize() {
          this.finalizeNotes = this.currentRating.notes || '';
          this.copiedDirection = false;
          this.showFinalize = true;
        },
        generateDirection() {
          const v = this.current;
          const m = this.meta;
          const title = m.topic ? m.topic.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase()) : m.project;
          let out = `## Design Direction — ${title}\n`;
          out += `Source: ${m.sourceDirectory}/v${m.round}.html (read exploration-metadata JSON from this file for full context)\n\n`;
          out += `**Chosen: ${v.id} "${v.name}"** — Family ${v.family} "${v.familyName}"\n`;
          const fam = m.families?.find(f => f.letter === v.family);
          if (fam?.approach) out += `Approach: ${fam.approach}\n`;
          out += `${v.layoutType} / ${v.aesthetic}: ${v.description}\n`;
          // Adjusted controls as absolute design specs
          const tuned = v.controls.filter(c => {
            if (c.defaultValue == null) return false;
            return JSON.stringify(c.value) !== JSON.stringify(c.defaultValue);
          });
          if (tuned.length) {
            out += `\nDesign specs (adjusted from defaults):\n`;
            tuned.forEach(c => {
              const u = c.unit || '';
              if (c.type === 'toggle') out += `- ${c.label}: ${c.value ? 'on' : 'off'}\n`;
              else out += `- ${c.label}: ${c.value}${u}\n`;
            });
          }
          return out;
        },
        copyDirection() {
          let full = this.generateDirection();
          const notes = this.finalizeNotes.trim();
          if (notes) full += `\n### Additional Notes\n${notes}\n`;
          navigator.clipboard.writeText(full);
          this.copiedDirection = true;
          setTimeout(() => { this.copiedDirection = false; }, 2000);
        },

        // --- Keyboard ---
        handleKey(e) {
          if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;
          switch(e.key) {
            case 'ArrowRight': case 'ArrowDown': this.next(); break;
            case 'ArrowLeft': case 'ArrowUp': this.prev(); break;
            case '0': this.rate(0); break;
            case '1': case '2': case '3': case '4': case '5': this.rate(+e.key); break;
            case 'l': case 'L': this.showControls = !this.showControls; break;
            case 'e': case 'E': this.showExport = !this.showExport; break;
            case 'r': case 'R': this.replayVariation(); break;
            case '?': this.showShortcuts = !this.showShortcuts; break;
            case 'Escape': this.showControls = false; this.showExport = false; this.showFinalize = false; this.showShortcuts = false; break;
          }
        },

        // --- Persistence ---
        storageKey(suffix) {
          const dir = (this.meta.sourceDirectory || '').split('/').pop() || this.meta.topic;
          return `design-exploration-${dir}-r${this.meta.round}-${suffix}`;
        },
        saveState() {
          localStorage.setItem(this.storageKey('ratings'), JSON.stringify(this.ratings));
        },
        loadState() {
          try { this.ratings = JSON.parse(localStorage.getItem(this.storageKey('ratings')) || '{}'); } catch(e) {}
          try {
            const cs = JSON.parse(localStorage.getItem(this.storageKey('controls')) || 'null');
            if (cs) {
              this.variations.forEach(v => {
                if (cs[v.id]) v.controls.forEach(c => { if (cs[v.id][c.id] !== undefined) c.value = cs[v.id][c.id]; });
              });
            }
          } catch(e) {}
        },
        saveControlState() {
          const state = {};
          this.variations.forEach(v => {
            state[v.id] = {};
            v.controls.forEach(c => { state[v.id][c.id] = c.value; });
          });
          localStorage.setItem(this.storageKey('controls'), JSON.stringify(state));
        },
      }
    }
  </script>
</body>
</html>
