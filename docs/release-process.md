# Release Process

This repo uses manual, on-demand releases. Merges to `main` do not publish automatically.

## Why

- Keeps PRs focused by decoupling merge timing from release timing
- Lets maintainers batch or defer releases intentionally
- Preserves automated release mechanics (versioning, changelog, npm, GitHub release, Homebrew)

## Triggering a Release

Run the GitHub Actions workflow from `main`:

```bash
# 1) Preview only (recommended first)
gh workflow run release.yml --ref main -f mode=dry-run

# 2) Publish
gh workflow run release.yml --ref main -f mode=publish
```

## What Happens on `mode=publish`

1. Installs dependencies and builds packages.
2. Runs `semantic-release`.
3. If releasable commits exist since the last tag:
   - Computes next version.
   - Updates `CHANGELOG.md`.
   - Updates release-synced files (for example plugin manifests, copied README).
   - Creates release commit (`chore(release): x.y.z`) and git tag.
   - Creates a GitHub Release.
   - Publishes `hzl-core`, `hzl-web`, and `hzl-cli` to npm.
   - Triggers `update-homebrew.yml` with the new version.
4. If no releasable commits exist, the workflow exits without publishing.

## Commit Types That Trigger Releases

- `feat` -> minor
- `fix` -> patch
- `perf` -> patch
- breaking change (`feat!` or `BREAKING CHANGE`) -> major

These do not trigger a release: `docs`, `chore`, `style`, `refactor`, `test`, `ci`, `build`.

## CHANGELOG.md Notes

`CHANGELOG.md` is generated by semantic-release from Conventional Commit data since the previous tag. It is grouped by release-note categories (for example Features, Bug Fixes, Performance), not a raw dump of all commit titles.

## Operational Notes

- Release workflow only supports `main`; running from other refs fails intentionally.
- `gh` must be authenticated and authorized to run workflows.
- Keep environment protection on the `release` environment for publish approvals.
